import{M as t,S as e,_ as s,a as n,k as r,E as i,b as o,h as a,i as c,u as l,r as d,c as h,m as u,I as p,t as m,w as g,d as k,s as f,e as w,l as x,D as b,f as v,g as y,P as M,j as $,T as O,n as A,o as C,p as E,q as L,v as I,x as R,y as S,z as _,A as T,B as N,C as P,F as j,G as D,H as B,J as z,R as W,K as V}from"./vendor.93296111.js";var q,U,F,G,H,Y,K,J,X;!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(s){const n=new URL(t,location),r=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((s,i)=>{const o=new URL(t,n);if(self[e].moduleMap[o])return s(self[e].moduleMap[o]);const a=new Blob([`import * as m from '${o}';`,`${e}.moduleMap['${o}']=m;`],{type:"text/javascript"}),c=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(a),onerror(){i(new Error(`Failed to import: ${t}`)),r(c)},onload(){s(self[e].moduleMap[o]),r(c)}});document.head.appendChild(c)})),self[e].moduleMap={}}}("/milkdown/assets/"),(U=q||(q={}))[U.Internal=0]="Internal",U[U.ProsemirrorSpec=1]="ProsemirrorSpec",U[U.ProsemirrorPlugin=2]="ProsemirrorPlugin",U[U.MarkdownItOption=3]="MarkdownItOption",U[U.MarkdownItPlugin=4]="MarkdownItPlugin",U[U.Theme=5]="Theme",U[U.Listener=6]="Listener",(G=F||(F={}))[G.Idle=0]="Idle",G[G.LoadSchema=1]="LoadSchema",G[G.SchemaReady=2]="SchemaReady",G[G.PluginReady=3]="PluginReady",G[G.Complete=4]="Complete";class Z{constructor(t={}){this.options=t}injectContext(t,e){this.context=t,this.updateContext=e}}class Q extends Z{constructor(){super(...arguments),this.loadAfter=F.Idle,this.type=q.ProsemirrorSpec}main(){this.updateContext({marks:this.context.marks.concat(this)})}}class tt extends Z{constructor(){super(...arguments),this.loadAfter=F.Idle,this.type=q.ProsemirrorSpec}main(){this.updateContext({nodes:this.context.nodes.concat(this)})}}function et(t,e,s={}){return t.reduce(((t,s)=>{const[n,r]=e(s);return Object.assign(Object.assign({},t),{[n]:r})}),s)}function st(t){return t.isText}class nt extends Z{constructor(){super(...arguments),this.id="schemaLoader",this.type=q.Internal,this.loadAfter=F.LoadSchema}main(){const t=et(this.context.nodes,(t=>[t.id,t.schema])),s=et(this.context.marks,(t=>[t.id,t.schema])),n=new e({nodes:Object.assign(Object.assign({doc:{content:"block+"}},t),{text:{group:"inline"}}),marks:s});this.updateContext({schema:n})}}class rt{constructor(t,e,s){this.stack=t,this.schema=e,this.tokenHandlers=s}parseTokens(t){t.forEach(((e,s)=>{const n=this.tokenHandlers[e.type];if(!n)throw new Error("Token type `"+e.type+"` not supported by Markdown parser");n(this,e,t,s)}))}addText(t){t&&this.stack.addText((e=>this.schema.text(t,e)))}transformTokensToDoc(t){this.parseTokens(t);let e=null;do{e=this.stack.closeNode()}while(this.stack.length);return e}}class it{constructor(e){this.els=[{type:e,content:[]}],this.marks=t.none}top(){const{els:t}=this;return t[t.length-1]}pushInTopEl(t){var e;null===(e=this.top())||void 0===e||e.content.push(t)}get length(){return this.els.length}openMark(t){this.marks=t.addToSet(this.marks)}closeMark(t){this.marks=t.removeFromSet(this.marks)}addText(e){const s=this.top();if(!s)throw new Error;const n=s.content,r=n[n.length-1],i=e(this.marks),o=r&&function(e,s){if(st(e)&&st(s)&&t.sameSet(e.marks,s.marks))return e.withText(e.text+s.text)}(r,i);o?n[n.length-1]=o:n.push(i)}openNode(t,e){this.els.push({type:t,attrs:e,content:[]})}addNode(t,e,s){const n=t.createAndFill(e,s,this.marks);return n?(this.pushInTopEl(n),n):null}closeNode(){this.marks.length&&(this.marks=t.none);const e=this.els.pop();if(!e)throw new Error;return this.addNode(e.type,e.attrs,e.content)}}function ot(t,e,s,n){return t.getAttrs?t.getAttrs(e,s,n):t.attrs}function at(){}function ct(t,e){const s={softbreak:t=>t.addText("\n")};return Object.entries(e).forEach((([e,n])=>{if(function(t){return Reflect.has(t,"block")}(n)){const r=t.nodes[n.block]||t.nodes[e];if(!r)throw new Error;return n.isAtom?void(s[n.block]=(t,e,s,i)=>{t.stack.openNode(r,ot(n,e,s,i)),t.addText(e.content),t.stack.closeNode()}):(s[n.block+"_open"]=(t,e,s,i)=>t.stack.openNode(r,ot(n,e,s,i)),void(s[n.block+"_close"]=t=>t.stack.closeNode()))}if(!function(t){return Reflect.has(t,"node")}(n)){if(function(t){return Reflect.has(t,"mark")}(n)){const r=t.marks[n.mark]||t.marks[e];if(!r)throw new Error;return n.isAtom?void(s[n.mark]=(t,e,s,i)=>{t.stack.openMark(r.create(ot(n,e,s,i))),t.addText(e.content),t.stack.closeMark(r)}):(s[n.mark+"_open"]=(t,e,s,i)=>t.stack.openMark(r.create(ot(n,e,s,i))),void(s[n.mark+"_close"]=t=>t.stack.closeMark(r)))}if(function(t){return Reflect.has(t,"ignore")}(n))return s[n.ignore+"_open"]=at,void(s[n.ignore+"_close"]=at);throw new RangeError("Unrecognized parsing spec "+JSON.stringify(n))}{const r=t.nodes[n.node]||t.nodes[e];if(!r)throw new Error;s[n.node]=(t,e,s,i)=>t.stack.addNode(r,ot(n,e,s,i))}})),s.inline=(t,e)=>{var s;return t.parseTokens(null!==(s=e.children)&&void 0!==s?s:[])},s.text=(t,e)=>t.addText(e.content),s}class lt extends Z{constructor(){super(...arguments),this.id="parserLoader",this.type=q.Internal,this.loadAfter=F.SchemaReady}main(){const t=et([...this.context.nodes,...this.context.marks],(t=>[t.id,t.parser])),e=(s=this.context.schema,n=this.context.markdownIt,r=t,t=>new rt(new it(s.topNodeType),s,ct(s,r)).transformTokensToDoc(n.parse(t,{})));var s,n,r;this.updateContext({parser:e})}}class dt{static escape(t,e){let s=t.replace(/[`*\\~[\]]/g,"\\$&");return e&&(s=s.replace(/^[:#\-*+]/,"\\$&").replace(/^(\d+)\./,"$1\\.")),s}static quote(t){const e=-1===t.indexOf('"')?'""':-1===t.indexOf("'")?"''":"()";return e[0]+t+e[1]}static repeat(t,e){return Array(e).fill(t).reduce(((t,e)=>t+e),"")}static getEnclosingWhitespace(t){return{leading:(t.match(/^(\s+)/)||[])[0],trailing:(t.match(/(\s+)$/)||[])[0]}}static removeWhiteSpaceAfter(t){const e=/\s+$/.exec(t);return e?t.slice(0,e.index):t}}class ht{constructor(t,e){H.set(this,""),Y.set(this,""),K.set(this,!1),J.set(this,void 0),X.set(this,void 0),this.utils=dt,s(this,J,t),s(this,X,e)}get output(){return n(this,H)}exec(t){return this.renderContent(t)}renderContent(t){return t.forEach(((e,s,n)=>this.render(e,t,n))),this}ensureNewLine(){return this.atBlank||s(this,H,n(this,H)+"\n"),this}closeBlock(t){return s(this,K,t),this}write(t){return this.flushClose(),t?(n(this,Y)&&this.atBlank&&s(this,H,n(this,H)+n(this,Y)),s(this,H,n(this,H)+t),this):this}text(t,e=!1){const r=t.split("\n");return r.forEach(((t,i)=>{const o=e?this.utils.escape(t,Boolean(this.atBlank||n(this,K))):t;this.write(o);i===r.length-1||s(this,H,n(this,H)+"\n")})),this}wrapBlock(t,e,r,i=t){this.write(i);const o=n(this,Y);return s(this,Y,n(this,Y)+t),r(),s(this,Y,o),this.closeBlock(e),this}renderInline(t){let e=[];return t.forEach(((s,n,r)=>{if(!st(s))return void this.render(s,t,r);const i=s.marks||[],o=e.filter((t=>!i.includes(t))).sort(this.compareMarkPriority()),a=i.filter((t=>!e.includes(t))).sort(this.compareMarkPriority(!0));a.forEach((t=>e.push(t))),e=e.filter((t=>!o.includes(t))).sort(this.compareMarkPriority());const c=this.serializeMarks(a,t,r,!0),l=this.serializeMarks(o,t,r+1);this.write(l+c+s.text)})),(()=>{const s=this.serializeMarks(e,t,t.childCount+1);this.write(s)})(),this}renderList(t,e,s){n(this,K)&&n(this,K).type===t.type&&this.flushClose(2),t.forEach(((n,r,i)=>{this.wrapBlock(e,t,(()=>this.render(n,t,i)),s(i))}))}get atBlank(){return/(^|\n)$/.test(n(this,H))}serializeMarks(t,e,s,n=!1){return t.map((t=>this.markString(t,e,s,n))).join("")}flushClose(t=1){if(!n(this,K))return this;this.atBlank||s(this,H,n(this,H)+"\n");const e=this.utils.removeWhiteSpaceAfter(n(this,Y));return s(this,H,n(this,H)+this.utils.repeat(e+"\n",t)),s(this,K,!1),this}markString(t,e,s,n=!1){const r=this.getMark(t),i=n?r.open:r.close;return"string"==typeof i?i:i(this,t,e,s)}render(t,e,s){this.getNode(t)(this,t,e,s)}compareMarkPriority(t=!1){return(e,s)=>{var n,r,i,o;const a=null!==(r=null===(n=this.getMark(e))||void 0===n?void 0:n.priority)&&void 0!==r?r:0,c=null!==(o=null===(i=this.getMark(s))||void 0===i?void 0:i.priority)&&void 0!==o?o:0;return t?a-c:c-a}}getMark(t){const e=n(this,X)[t.type.name];if(!e)throw new Error(`Fail to get mark ${t.type.name} from mark map.`);return e}getNode(t){const e=n(this,J)[t.type.name];if(!e)throw new Error(`Fail to get node ${t.type.name} from node map.`);return e}}H=new WeakMap,Y=new WeakMap,K=new WeakMap,J=new WeakMap,X=new WeakMap;class ut extends Z{constructor(){super(...arguments),this.id="serializerLoader",this.type=q.Internal,this.loadAfter=F.SchemaReady}main(){const t=function(t,e){return s=>{const n=new ht(t,e);return n.exec(s),n.output}}(et(this.context.nodes,(t=>[t.id,t.serializer]),{text(t,e){const{text:s}=e;s&&t.text(s)}}),et(this.context.marks,(t=>[t.id,t.serializer])));this.updateContext({serializer:t})}}class pt extends Z{constructor(){super(...arguments),this.id="inputRulesLoader",this.type=q.Internal,this.loadAfter=F.SchemaReady}main(){const{nodes:t,marks:e,schema:s}=this.context,n=[...t.filter((t=>Boolean(t.inputRules))).reduce(((t,e)=>{const n=s.nodes[e.id];return n?[...t,...e.inputRules(n,s)]:t}),[]),...e.filter((t=>Boolean(t.inputRules))).reduce(((t,e)=>{const n=s.marks[e.id];return n?[...t,...e.inputRules(n,s)]:t}),[])];this.updateContext({inputRules:n})}}class mt extends Z{constructor(){super(...arguments),this.id="keymapLoader",this.type=q.Internal,this.loadAfter=F.SchemaReady}main(){const{nodes:t,marks:e,schema:s}=this.context,n=[...t.filter((t=>Boolean(t.keymap))).map((t=>{const e=s.nodes[t.id];if(!e)throw new Error;return t.keymap(e)})),...e.filter((t=>Boolean(t.keymap))).map((t=>{const e=s.marks[t.id];if(!e)throw new Error;return t.keymap(e)}))].map((t=>r(t)));this.updateContext({keymap:n})}}class gt extends Z{constructor(){super(...arguments),this.id="nodeViewsLoader",this.type=q.Internal,this.loadAfter=F.SchemaReady}main(){const{nodes:t,marks:e,schema:s,editor:n}=this.context,r=t.filter((t=>Boolean(t.view))).reduce(((t,e)=>{const r=s.nodes[e.id];if(!r)throw new Error;return Object.assign(Object.assign({},t),{[e.id]:(...t)=>e.view(n,r,...t)})}),{}),i=e.filter((t=>Boolean(t.view))).reduce(((t,e)=>{const r=s.marks[e.id];if(!r)throw new Error;return Object.assign(Object.assign({},t),{[e.id]:(...t)=>e.view(n,r,...t)})}),{}),o=Object.assign(Object.assign({},r),i);this.updateContext({nodeViews:o})}}class kt extends Z{constructor(){super(...arguments),this.id="viewLoader",this.type=q.Internal,this.loadAfter=F.PluginReady}main(){const{nodeViews:t,serializer:e}=this.context,{listener:s}=this.options,n=this.createState(),r=this.createViewContainer(),o=new i(r,{state:n,nodeViews:t,dispatchTransaction:t=>{var n,r;const i=o.state.apply(t);o.updateState(i),null===(n=s.markdown)||void 0===n||n.forEach((t=>{t((()=>e(o.state.doc)))})),null===(r=s.doc)||void 0===r||r.forEach((t=>{t(o.state.doc)}))}});this.prepareViewDom(o.dom),this.updateContext({editorView:o})}createState(){const{parser:t,schema:e,inputRules:s,keymap:n,prosemirrorPlugins:i}=this.context,{defaultValue:u}=this.options,p=t(u);return o.create({schema:e,doc:p,plugins:[a(),r({"Mod-z":l,"Shift-Mod-z":d}),...n,...i,r(h),c({rules:s})]})}createViewContainer(){const{root:t}=this.options,e=document.createElement("div");return e.className="milkdown",t.appendChild(e),e}prepareViewDom(t){t.classList.add("editor"),t.setAttribute("role","textbox")}}const ft=t=>class extends Z{constructor(){super(...arguments),this.id=t,this.type=q.ProsemirrorPlugin,this.loadAfter=F.SchemaReady}main(){this.updateContext({prosemirrorPlugins:this.context.prosemirrorPlugins.concat(...this.options.plugins(this.context))})}},wt=(t,e)=>new(ft(t))({plugins:e}),xt=t=>class extends Z{constructor(){super(...arguments),this.id=t,this.type=q.ProsemirrorPlugin,this.loadAfter=F.SchemaReady}main(){const t=this.options.plugins(this.context).reduce(((t,e)=>Array.isArray(e)?t.use(...e):t.use(e)),this.context.markdownIt);this.updateContext({markdownIt:t})}};function bt(t,e){return new p(t,((t,s,n,r)=>{const{tr:i}=t,o=s.length;let a=n,c=r;if(s[o-1]){const l=s[0],d=s[o-1],h=s[o-2],u=n+l.indexOf(h),p=u+h.length-1,m=u+h.lastIndexOf(d),g=m+d.length;if(function(t,e,s){let n=[];return s.doc.nodesBetween(t,e,((t,e)=>{n=[...n,...t.marks.map((s=>({start:e,end:e+t.nodeSize,mark:s})))]})),n}(n,r,t).filter((t=>t.mark.type.excludes(e))).filter((t=>t.end>u)).length)return null;g<p&&i.delete(g,p),m>u&&i.delete(u,m),a=u,c=a+d.length}return i.addMark(a,c,e.create()),i.removeStoredMark(e),i}))}const vt=[new class extends Q{constructor(){super(...arguments),this.id="link",this.schema={attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:t=>({href:t.getAttribute("href"),title:t.getAttribute("title")})}],toDOM:t=>["a",Object.assign(Object.assign({},t.attrs),{class:"link"})]},this.parser={mark:"link",getAttrs:t=>({href:t.attrGet("href"),title:t.attrGet("title")||null})},this.serializer={open:()=>"[",close:(t,e)=>`](${t.utils.escape(e.attrs.href)}${e.attrs.title?` ${t.utils.quote(e.attrs.title)}`:""})`,priority:1},this.inputRules=(t,e)=>[new p(/\[(?<text>.+?)]\((?<href>.*?)(?=“|\))"?(?<title>[^"]+)?"?\)/,((s,n,r,i)=>{const[o,a="",c,l]=n,{tr:d}=s;return o&&d.replaceWith(r,i,e.text(a)).addMark(r,a.length+r,t.create({title:l,href:c})),d}))]}},new class extends Q{constructor(){super(...arguments),this.id="strong",this.schema={parseDOM:[{tag:"b"},{tag:"strong"},{style:"font-style",getAttrs:t=>"bold"===t}],toDOM:()=>["strong",{class:"strong"}]},this.parser={mark:this.id},this.serializer={open:"**",close:"**"},this.inputRules=t=>[bt(/(?:__)([^_]+)(?:__)$/,t),bt(/(?:\*\*)([^*]+)(?:\*\*)$/,t)],this.keymap=t=>({"Mod-b":m(t)})}},new class extends Q{constructor(){super(...arguments),this.id="code_inline",this.schema={excludes:"_",parseDOM:[{tag:"code"}],toDOM:()=>["code",{class:"code-inline"}]},this.parser={mark:"code_inline",isAtom:!0},this.serializer={open:"`",close:"`"},this.inputRules=t=>[bt(/(?:^|[^`])(`([^`]+)`)$/,t)]}},new class extends Q{constructor(){super(...arguments),this.id="em",this.schema={parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style",getAttrs:t=>"italic"===t}],toDOM:()=>["em",{class:"em"}]},this.parser={mark:"em"},this.serializer={open:"*",close:"*"},this.inputRules=t=>[bt(/(?:^|[^_])(_([^_]+)_)$/,t),bt(/(?:^|[^*])(\*([^*]+)\*)$/,t)],this.keymap=t=>({"Mod-i":m(t)})}}];const yt=Array(5).fill(0).map(((t,e)=>e+1));const Mt=["","javascript","typescript","bash","sql","json","c","cpp","java","ruby","python","go","rust"];const $t=[new class extends tt{constructor(){super(...arguments),this.id="paragraph",this.schema={content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>["p",{class:"paragraph"},0]},this.parser={block:this.id},this.serializer=(t,e)=>{t.renderInline(e).closeBlock(e)}}},new class extends tt{constructor(){super(...arguments),this.id="hardbreak",this.schema={inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br",{class:"bard-break"}]},this.parser={block:this.id,isAtom:!0},this.serializer=t=>{t.write("  \n")},this.keymap=t=>({"Shift-Enter":(e,s)=>(null==s||s(e.tr.replaceSelectionWith(t.create()).scrollIntoView()),!0)})}},new class extends tt{constructor(){super(...arguments),this.id="blockquote",this.schema={content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",{class:"blockquote"},0]},this.parser={block:this.id},this.serializer=(t,e)=>{t.wrapBlock("> ",e,(()=>t.renderContent(e)))},this.inputRules=t=>[g(/^\s*>\s$/,t)]}},new class extends tt{constructor(){super(...arguments),this.id="fence",this.schema={content:"text*",group:"block",marks:"",defining:!0,code:!0,attrs:{language:{default:""}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:t=>({language:t.dataset.language})}],toDOM:t=>{const e=this.createSelectElement(t.attrs.language);return["div",{"data-language":t.attrs.language,class:"code-fence"},["div",{contentEditable:"false"},e],["pre",["code",{spellCheck:"false"},0]]]}},this.parser={block:this.id,getAttrs:t=>({language:t.info}),isAtom:!0},this.serializer=(t,e)=>{t.write("```"+e.attrs.language+"\n"),t.text(e.textContent),t.ensureNewLine(),t.write("```"),t.closeBlock(e)},this.inputRules=t=>[k(/^```$/,t)],this.keymap=()=>({Tab:(t,e)=>{const{tr:s,selection:n}=t;return!!e&&(e(s.insertText("  ",n.from,n.to)),!0)}})}onChangeLanguage(t,e,s){const{editorView:n}=this.context,r=n.posAtCoords({top:t,left:e});if(!r)return;const i=n.state.tr.setNodeMarkup(r.inside,void 0,{language:s});n.dispatch(i)}createSelectElement(t){const e=document.createElement("select");return e.className="code-fence_select",e.addEventListener("change",(t=>{if(this.context.loadState!==F.Complete)throw new Error("Should not trigger event before milkdown ready.");const e=t.target;if(!e)return;const{top:s,left:n}=e.getBoundingClientRect();this.onChangeLanguage(s,n,e.value)})),Mt.forEach((s=>{const n=document.createElement("option");n.className="code-fence_select-option",n.value=s,n.innerText=s||"--",n.selected=t===s,e.appendChild(n)})),e}},new class extends tt{constructor(){super(...arguments),this.id="ordered_list",this.schema={content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:t=>({order:t.hasAttribute("start")?Number(t.getAttribute("start")):1})}],toDOM:t=>["ol",Object.assign(Object.assign({},1===t.attrs.order?{}:t.attrs.order),{class:"ordered-list"}),0]},this.parser={block:this.id},this.serializer=(t,e)=>{const{order:s=1}=e.attrs,n=(""+(s+e.childCount-1)).length,r=t.utils.repeat(" ",n+2);t.renderList(e,r,(e=>{const r=`${s+e}`;return t.utils.repeat(" ",n-r.length)+r+". "}))},this.inputRules=t=>[g(/^(\d+)\.\s$/,t,(t=>({order:Number(t[1])})),((t,e)=>e.childCount+e.attrs.order===Number(t[1])))]}},new class extends tt{constructor(){super(...arguments),this.id="bullet_list",this.schema={content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",{class:"bullet-list"},0]},this.parser={block:this.id},this.serializer=(t,e)=>{t.renderList(e,"  ",(()=>"* "))},this.inputRules=t=>[g(/^\s*([-+*])\s$/,t)]}},new class extends tt{constructor(){super(...arguments),this.id="list_item",this.schema={content:"paragraph block*",defining:!0,parseDOM:[{tag:"li"}],toDOM:()=>["li",{class:"list-item"},0]},this.parser={block:this.id},this.serializer=(t,e)=>{t.renderContent(e)},this.keymap=t=>({Enter:f(t),"Mod-]":w(t),"Mod-[":x(t)})}},new class extends tt{constructor(){super(...arguments),this.id="heading",this.schema={content:"text*",group:"block",attrs:{level:{default:1}},parseDOM:yt.map((t=>({tag:`h${t}`,attrs:{level:t}}))),toDOM:t=>[`h${t.attrs.level}`,{class:`heading h${t.attrs.level}`},0]},this.parser={block:this.id,getAttrs:t=>({level:Number(t.tag.slice(1))})},this.serializer=(t,e)=>{t.write(`${t.utils.repeat("#",e.attrs.level)} `),t.renderInline(e),t.closeBlock(e)},this.inputRules=t=>yt.map((e=>k(new RegExp(`^(#{1,${e}})\\s$`),t,(()=>({level:e})))))}},new class extends tt{constructor(){super(...arguments),this.id="hr",this.schema={group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr",{class:"hr"}]},this.parser={block:this.id,isAtom:!0},this.serializer=(t,e)=>{t.write("---"),t.closeBlock(e)},this.inputRules=t=>[new p(/^(?:---|___\s|\*\*\*\s)$/,((e,s,n,r)=>{const{tr:i}=e;return s[0]&&i.replaceWith(n,r,t.create({})),i}))]}},new class extends tt{constructor(){super(...arguments),this.id="image",this.schema={inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,marks:"",parseDOM:[{tag:"img[src]",getAttrs:t=>({src:t.getAttribute("src"),alt:t.getAttribute("alt"),title:t.getAttribute("title")})}],toDOM:t=>["img",Object.assign(Object.assign({},t.attrs),{class:"image"})]},this.parser={node:"image",getAttrs:t=>{var e,s;return{src:t.attrGet("src"),alt:(null===(s=null===(e=t.children)||void 0===e?void 0:e[0])||void 0===s?void 0:s.content)||null,title:t.attrGet("title")}}},this.serializer=(t,e)=>{const s=t.utils.escape(e.attrs.alt||""),n=e.attrs.title?" "+t.utils.quote(e.attrs.title):"",r=t.utils.escape(e.attrs.src)+n;t.write(`![${s}](${r}) `)},this.inputRules=t=>[new p(/!\[(?<alt>.*?)]\((?<filename>.*?)(?=“|\))"?(?<title>[^"]+)?"?\)/,((e,s,n,r)=>{const[i,o,a,c]=s,{tr:l}=e;return i&&l.replaceWith(n,r,t.create({src:a,alt:o,title:c})),l}))]}},new class extends tt{constructor(){super(...arguments),this.id="tab_indent",this.schema={group:"inline",inline:!0,selectable:!1,parseDOM:[{tag:"span[class='tab-indent']"}],toDOM:()=>["span",{class:"tab-indent"},"  "]},this.parser={block:this.id},this.serializer=t=>{t.write("  ")},this.keymap=t=>({Tab:(e,s)=>{const{selection:n}=e.tr,r=Boolean(e.tr);if(!n)return r;const{from:i,to:o}=n;if(i!==o||!t)return r;const a=e.tr.replaceSelectionWith(t.create()).scrollIntoView();return null==s||s(a),Boolean(a)}})}}],Ot=(At=t=>t.isBlock,(t,e)=>((t,e=!0)=>{const s=[];return t.descendants(((t,n)=>{if(s.push({node:t,pos:n}),!e)return!1})),s})(t,e).filter((t=>At(t.node))));var At;const Ct={};const Et="MILKDOWN_PLUGIN_PRISM";function Lt(t){let e=!1;return new M({key:new $(Et),state:{init:(t,{doc:e})=>b.create(e,[]),apply:(s,n,r,i)=>{const o=i.selection.$head.parent.type.name===t,a=r.selection.$head.parent.type.name===t,c=s.docChanged&&(o||a);return!e||c?(e=!0,function(t,e){const s=[],n=Ot(t).filter((t=>t.node.type.name===e));return n.forEach((t=>{var e;let n=t.pos+1;const r=t.node.attrs.language;if(r){if(!(null===(e=Ct[t.pos])||void 0===e?void 0:e.node.eq(t.node))){const e=v.highlight(t.node.textContent,r),s=(t,e=[])=>t.flatMap((t=>"element"===t.type?s(t.children,[...e,...t.properties.className||[]]):[{text:t.value,className:e}])),i=s(e).map((({text:t,className:e})=>{const s=n,r=s+t.length;return n=r,y.inline(s,r,{class:e.join(" ")})}));Ct[t.pos]={node:t.node,dec:i}}Ct[t.pos].dec.forEach((t=>{s.push(t)}))}})),Object.keys(Ct).filter((t=>!n.find((e=>e.pos===Number(t))))).forEach((t=>{delete Ct[Number(t)]})),b.create(t,s)}(s.doc,t)):n.map(s.mapping,s.doc)}},view:t=>(window.requestAnimationFrame((()=>{t.dispatch(t.state.tr.setMeta(Et,{loaded:!0}))})),{}),props:{decorations(t){return this.getState(t)}}})}const It=wt("prism",(()=>[Lt("fence")]));function Rt(t){const e=document.createElement("span");return e.textContent=t,e.className="icon material-icons material-icons-outlined",e}function St(){const t=document.createElement("div");t.className="group";const e=document.createElement("input");e.className="icon input";const s=Rt("check_circle");return t.appendChild(e),t.appendChild(s),t}var _t,Tt;function Nt(t,e){const{from:s,to:n}=t.state.selection;return t.state.doc.rangeHasMark(s,n,e)}function Pt(t,e){let s;const{from:n,to:r}=t.selection;return t.doc.nodesBetween(n,r,(t=>{if(s)return!1;t.marks.find((t=>t.type===e))&&(s=t)})),s}function jt(t,e){return!(t.state.selection instanceof O)||function(t){return"fence"===t.selection.$head.parent.type.name}(t.state)||Nt(t,e)}(Tt=_t||(_t={}))[Tt.ToggleBold=0]="ToggleBold",Tt[Tt.ToggleItalic=1]="ToggleItalic",Tt[Tt.ToggleCode=2]="ToggleCode",Tt[Tt.ToggleLink=3]="ToggleLink",Tt[Tt.ModifyLink=4]="ModifyLink";const Dt=t=>{const{marks:e}=t.schema;return{[_t.ToggleBold]:{$:Rt("format_bold"),command:()=>m(e.strong),active:t=>Nt(t,e.strong),disable:t=>jt(t,e.code_inline)},[_t.ToggleItalic]:{$:Rt("format_italic"),command:()=>m(e.em),active:t=>Nt(t,e.em),disable:t=>jt(t,e.code_inline)},[_t.ToggleCode]:{$:Rt("code"),command:()=>m(e.code_inline),active:t=>Nt(t,e.code_inline),disable:t=>jt(t,e.link)},[_t.ToggleLink]:{$:Rt("link"),command:()=>m(e.link,{href:""}),active:t=>Nt(t,e.link),disable:t=>jt(t,e.code_inline)},[_t.ModifyLink]:{$:St(),command:(t,s)=>{const n=t.target;if(n.tagName==="input".toUpperCase())return n.focus(),()=>!1;if(n.tagName==="span".toUpperCase()){const t=Pt(s.state,e.link);if(!t)return()=>!1;const r=t.marks.find((t=>t.type===e.link));if(!r)return()=>!1;const{start:i,end:o}=function(t,e,s,n){let r={start:-1,end:-1};return e.nodesBetween(s,n,((e,s)=>{if(r.start>-1)return!1;-1===r.start&&t.isInSet(e.marks)&&(r={start:s,end:s+Math.max(e.textContent.length,1)})})),r}(r,s.state.doc,s.state.selection.from,s.state.selection.to);return(t,s)=>{var a;if(!s)return!1;const{tr:c}=t;return c.removeMark(i,o),c.addMark(i,o,e.link.create(Object.assign(Object.assign({},r.attrs),{href:(null===(a=n.parentNode)||void 0===a?void 0:a.firstChild).value}))),c.setSelection(new O(c.selection.$anchor)),s(c.scrollIntoView()),!0}}return()=>!0},active:()=>!1,disable:t=>!Nt(t,e.link),update:(t,s)=>{const n=Pt(t.state,e.link);if(!n)return;const r=n.marks.find((t=>t.type===e.link));r&&(s.firstChild.value=r.attrs.href)}}}};class Bt{constructor(t,e,s){var n;this.ctx=t,this.items=e,this.view=s,this.listener=t=>{const{view:e}=this;e&&(t.stopPropagation(),Object.values(this.items).forEach((({$:s,command:n})=>{s.contains(t.target)&&n(t,e)(e.state,e.dispatch)})))},this.$=document.createElement("div"),this.$.className="tooltip",Object.values(e).forEach((({$:t})=>this.$.appendChild(t))),null===(n=s.dom.parentNode)||void 0===n||n.appendChild(this.$),this.update(s),this.$.addEventListener("mousedown",this.listener)}update(t,e){const s=t.state;(null==e?void 0:e.doc.eq(s.doc))&&e.selection.eq(s.selection)||(s.selection.empty?this.hide():(this.calculateItem(t),Object.values(this.items).every((({$:t})=>t.classList.contains("hide")))||(this.$.classList.remove("hide"),this.calculatePosition(t))))}destroy(){this.$.removeEventListener("mousedown",this.listener),this.$.remove()}hide(){this.$.classList.add("hide")}calculateItem(t){Object.values(this.items).forEach((e=>{var s,n;if(null===(s=e.disable)||void 0===s?void 0:s.call(e,t))return void e.$.classList.add("hide");e.$.classList.remove("hide"),null===(n=e.update)||void 0===n||n.call(e,t,e.$);e.active(t)?e.$.classList.add("active"):e.$.classList.remove("active")}))}calculatePosition(t){var e;const s=t.state,{from:n,to:r}=s.selection,i=t.coordsAtPos(n),o=t.coordsAtPos(r),a=Math.max((i.left+o.left)/2,i.left+3),c=null===(e=this.$.offsetParent)||void 0===e?void 0:e.getBoundingClientRect();c&&(this.$.style.left=a-c.left+"px",this.$.style.bottom=c.bottom-i.top+"px")}}const zt=t=>new M({key:new $("MILKDOWN_PLUGIN_TOOLTIP"),view:e=>new Bt(t,Dt(t),e)}),Wt=wt("tooltip",(t=>[zt(t)]));const Vt=r({Backspace:A(I,R,S,_),"Mod-Enter":A(T,N,P,j),Delete:A(I,D,B)}),qt=[new class extends tt{constructor(){super(...arguments),this.id="math_inline",this.schema={group:"inline math",content:"text*",inline:!0,atom:!0,parseDOM:[{tag:"math-inline"}],toDOM:()=>["math-inline",{class:"math-node"},0]},this.parser={block:this.id,isAtom:!0},this.serializer=(t,e)=>{t.write("$"),t.renderContent(e),t.write("$")},this.inputRules=t=>[E(W,t)]}},new class extends tt{constructor(){super(...arguments),this.id="math_display",this.schema={group:"block math",content:"text*",atom:!0,code:!0,parseDOM:[{tag:"math-display"}],toDOM:()=>["math-display",{class:"math-node"},0]},this.parser={block:"math_block",isAtom:!0},this.serializer=(t,e)=>{t.write("$$").ensureNewLine().renderContent(e).ensureNewLine().write("$$").closeBlock(e)},this.inputRules=t=>[L(V,t)]}},wt("mathProsemirrorPlugin",(()=>[C,Vt])),(Ut="mathMarkdownItPlugin",Ft=()=>[z],new(xt(Ut))({plugins:Ft}))];var Ut,Ft;const Gt=document.getElementById("app");if(!Gt)throw new Error;const Ht=new class{constructor(t){this.atoms=[],this.ctx={loadState:F.Idle,markdownIt:new u("commonmark"),nodes:[],marks:[],editor:this,prosemirrorPlugins:[]},this.updateCtx=t=>{Object.assign(this.ctx,t)};const e=Object.assign({root:document.body,defaultValue:"",listener:{}},t);this.use([new nt,new lt,new ut,new mt,new pt,new gt,new kt(e)])}injectCtx(){this.atoms.forEach((t=>t.injectContext(this.ctx,this.updateCtx)))}runAtomByLoadState(t){this.atoms.filter((e=>e.loadAfter===t)).forEach((t=>{t.main()}))}addAtom(t){const e=this.atoms.findIndex((e=>e.id===t.id));e>=0&&(console.warn(`Atom: ${t.id} is conflicted with previous atom, the previous one will be override.`),this.atoms.splice(e,1)),this.atoms.push(t)}use(t){return Array.isArray(t)?(t.forEach((t=>{this.addAtom(t)})),this):(this.addAtom(t),this)}create(){this.injectCtx(),[F.Idle,F.LoadSchema,F.SchemaReady,F.PluginReady,F.Complete].forEach((t=>{this.ctx.loadState=t,this.runAtomByLoadState(t)}))}}({root:Gt,defaultValue:"\n# Milkdown\n\n![logo](/milkdown/milkdown-mini.svg)\n\n> Milkdown is a WYSIWYG markdown editor.\n>\n> Here is the [repo](https://github.com/Saul-Mirone/milkdown) (*right click to open link*).\n\nYou can check the output markdown text in **developer tool**.\n\n---\n\nYou can add `inline code` and code block:\n\n```javascript\nfunction main() {\n    console.log('Hello milkdown!');\n}\n```\n\n---\n\nMath is supported by [TeX expression](https://en.wikipedia.org/wiki/TeX).\n\nNow we have some inline math: $V \\times W \\stackrel{\\otimes}{\\rightarrow} V \\otimes W$. You can click to edit it.\n\nMath block is also supported. \n\n$$\n\\mathcal{L}(V \\otimes W, Z) \\cong \\big\\{ \\substack{\\text{bilinear maps}\\\\{V \\times W \\rightarrow Z}} \\big\\}\n$$\n\nYou can type `$$` and a `space` to create a math block.\n\n---\n\nHave fun!\n",listener:{markdown:[t=>console.log(t())]}}).use($t).use(vt).use(It).use(qt);/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||Ht.use(Wt),Ht.create();

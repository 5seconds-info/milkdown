import{M as t,S as e,_ as s,a as n,k as i,E as o,b as r,h as a,u as l,r as c,c as d,i as h,m as u,I as p,t as m,w as f,d as g,s as w,e as v,l as k,D as b,f as y,g as x,P as M,j as A,T as E,N as L,n as C,o as _,R as $,p as O,q as S,v as R,x as T,y as I,z as P,A as N,B as D,C as B,F as j,G as W,H as z,J as H,K as F,L as V,O as q,Q as U,U as G,V as Y,W as K,X as Q,Y as X,Z as J,$ as Z,a0 as tt,a1 as et,a2 as st,a3 as nt,a4 as it}from"./vendor.ffe82b4f.js";var ot,rt,at,lt,ct,dt,ht,ut,pt;!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(s){const n=new URL(t,location),i=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((s,o)=>{const r=new URL(t,n);if(self[e].moduleMap[r])return s(self[e].moduleMap[r]);const a=new Blob([`import * as m from '${r}';`,`${e}.moduleMap['${r}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(a),onerror(){o(new Error(`Failed to import: ${t}`)),i(l)},onload(){s(self[e].moduleMap[r]),i(l)}});document.head.appendChild(l)})),self[e].moduleMap={}}}("/milkdown/assets/"),(rt=ot||(ot={}))[rt.Internal=0]="Internal",rt[rt.ProsemirrorSpec=1]="ProsemirrorSpec",rt[rt.ProsemirrorPlugin=2]="ProsemirrorPlugin",rt[rt.MarkdownItOption=3]="MarkdownItOption",rt[rt.MarkdownItPlugin=4]="MarkdownItPlugin",rt[rt.Theme=5]="Theme",rt[rt.Listener=6]="Listener",(lt=at||(at={}))[lt.Idle=0]="Idle",lt[lt.LoadSchema=1]="LoadSchema",lt[lt.SchemaReady=2]="SchemaReady",lt[lt.PluginReady=3]="PluginReady",lt[lt.Complete=4]="Complete";class mt{constructor(t={}){this.options=t}injectContext(t,e){this.context=t,this.updateContext=e}}class ft extends mt{constructor(){super(...arguments),this.loadAfter=at.Idle,this.type=ot.ProsemirrorSpec}main(){this.updateContext({marks:this.context.marks.concat(this)})}}class gt extends mt{constructor(){super(...arguments),this.loadAfter=at.Idle,this.type=ot.ProsemirrorSpec}main(){this.updateContext({nodes:this.context.nodes.concat(this)})}}function wt(t,e,s={}){return t.reduce(((t,s)=>{const[n,i]=e(s);return Object.assign(Object.assign({},t),{[n]:i})}),s)}function vt(t){return t.isText}class kt extends mt{constructor(){super(...arguments),this.id="schemaLoader",this.type=ot.Internal,this.loadAfter=at.LoadSchema}main(){const t=wt(this.context.nodes,(t=>[t.id,t.schema])),s=wt(this.context.marks,(t=>[t.id,t.schema])),n=new e({nodes:Object.assign(Object.assign({doc:{content:"block+"}},t),{text:{group:"inline"}}),marks:s});this.updateContext({schema:n})}}class bt{constructor(t,e,s){this.stack=t,this.schema=e,this.tokenHandlers=s}parseTokens(t){t.forEach(((e,s)=>{const n=this.tokenHandlers[e.type];if(!n)throw new Error("Token type `"+e.type+"` not supported by Markdown parser");n(this,e,t,s)}))}addText(t){t&&this.stack.addText((e=>this.schema.text(t,e)))}transformTokensToDoc(t){this.parseTokens(t);let e=null;do{e=this.stack.closeNode()}while(this.stack.length);return e}}class yt{constructor(e){this.els=[{type:e,content:[]}],this.marks=t.none}top(){const{els:t}=this;return t[t.length-1]}pushInTopEl(t){var e;null===(e=this.top())||void 0===e||e.content.push(t)}get length(){return this.els.length}openMark(t){this.marks=t.addToSet(this.marks)}closeMark(t){this.marks=t.removeFromSet(this.marks)}addText(e){const s=this.top();if(!s)throw new Error;const n=s.content,i=n[n.length-1],o=e(this.marks),r=i&&function(e,s){if(vt(e)&&vt(s)&&t.sameSet(e.marks,s.marks))return e.withText(e.text+s.text)}(i,o);r?n[n.length-1]=r:n.push(o)}openNode(t,e){this.els.push({type:t,attrs:e,content:[]})}addNode(t,e,s){const n=t.createAndFill(e,s,this.marks);return n?(this.pushInTopEl(n),n):null}closeNode(){this.marks.length&&(this.marks=t.none);const e=this.els.pop();if(!e)throw new Error;return this.addNode(e.type,e.attrs,e.content)}}function xt(t,e,s,n){return t.getAttrs?t.getAttrs(e,s,n):t.attrs}function Mt(){}function At(t,e){const s={softbreak:t=>t.addText("\n")};return Object.entries(e).forEach((([e,n])=>{if(function(t){return Reflect.has(t,"block")}(n)){const i=t.nodes[n.block]||t.nodes[e];if(!i)throw new Error;return n.isAtom?void(s[n.block]=(t,e,s,o)=>{t.stack.openNode(i,xt(n,e,s,o)),t.addText(e.content),t.stack.closeNode()}):(s[n.block+"_open"]=(t,e,s,o)=>t.stack.openNode(i,xt(n,e,s,o)),void(s[n.block+"_close"]=t=>t.stack.closeNode()))}if(!function(t){return Reflect.has(t,"node")}(n)){if(function(t){return Reflect.has(t,"mark")}(n)){const i=t.marks[n.mark]||t.marks[e];if(!i)throw new Error;return n.isAtom?void(s[n.mark]=(t,e,s,o)=>{t.stack.openMark(i.create(xt(n,e,s,o))),t.addText(e.content),t.stack.closeMark(i)}):(s[n.mark+"_open"]=(t,e,s,o)=>t.stack.openMark(i.create(xt(n,e,s,o))),void(s[n.mark+"_close"]=t=>t.stack.closeMark(i)))}if(function(t){return Reflect.has(t,"ignore")}(n))return s[n.ignore+"_open"]=Mt,void(s[n.ignore+"_close"]=Mt);throw new RangeError("Unrecognized parsing spec "+JSON.stringify(n))}{const i=t.nodes[n.node]||t.nodes[e];if(!i)throw new Error;s[n.node]=(t,e,s,o)=>t.stack.addNode(i,xt(n,e,s,o))}})),s.inline=(t,e)=>{var s;return t.parseTokens(null!==(s=e.children)&&void 0!==s?s:[])},s.text=(t,e)=>t.addText(e.content),s}class Et extends mt{constructor(){super(...arguments),this.id="parserLoader",this.type=ot.Internal,this.loadAfter=at.SchemaReady}main(){const t=wt([...this.context.nodes,...this.context.marks],(t=>[t.id,t.parser])),e=(s=this.context.schema,n=this.context.markdownIt,i=t,t=>new bt(new yt(s.topNodeType),s,At(s,i)).transformTokensToDoc(n.parse(t,{})));var s,n,i;this.updateContext({parser:e})}}class Lt{static escape(t,e){let s=t.replace(/[`*\\~[\]]/g,"\\$&");return e&&(s=s.replace(/^[:#\-*+]/,"\\$&").replace(/^(\d+)\./,"$1\\.")),s}static quote(t){const e=-1===t.indexOf('"')?'""':-1===t.indexOf("'")?"''":"()";return e[0]+t+e[1]}static repeat(t,e){return Array(e).fill(t).reduce(((t,e)=>t+e),"")}static getEnclosingWhitespace(t){return{leading:(t.match(/^(\s+)/)||[])[0],trailing:(t.match(/(\s+)$/)||[])[0]}}static removeWhiteSpaceAfter(t){const e=/\s+$/.exec(t);return e?t.slice(0,e.index):t}}class Ct{constructor(t,e){ct.set(this,""),dt.set(this,""),ht.set(this,!1),ut.set(this,void 0),pt.set(this,void 0),this.utils=Lt,s(this,ut,t),s(this,pt,e)}get output(){return n(this,ct)}exec(t){return this.renderContent(t)}renderContent(t){return t.forEach(((e,s,n)=>this.render(e,t,n))),this}ensureNewLine(){return this.atBlank||s(this,ct,n(this,ct)+"\n"),this}closeBlock(t){return s(this,ht,t),this}write(t){return this.flushClose(),t?(n(this,dt)&&this.atBlank&&s(this,ct,n(this,ct)+n(this,dt)),s(this,ct,n(this,ct)+t),this):this}text(t,e=!1){const i=t.split("\n");return i.forEach(((t,o)=>{const r=e?this.utils.escape(t,Boolean(this.atBlank||n(this,ht))):t;this.write(r);o===i.length-1||s(this,ct,n(this,ct)+"\n")})),this}wrapBlock(t,e,i,o=t){this.write(o);const r=n(this,dt);return s(this,dt,n(this,dt)+t),i(),s(this,dt,r),this.closeBlock(e),this}renderInline(t){let e=[];return t.forEach(((s,n,i)=>{if(!vt(s))return void this.render(s,t,i);const o=s.marks||[],r=e.filter((t=>!o.includes(t))).sort(this.compareMarkPriority()),a=o.filter((t=>!e.includes(t))).sort(this.compareMarkPriority(!0));a.forEach((t=>e.push(t))),e=e.filter((t=>!r.includes(t))).sort(this.compareMarkPriority());const l=this.serializeMarks(a,t,i,!0),c=this.serializeMarks(r,t,i+1);this.write(c+l+s.text)})),(()=>{const s=this.serializeMarks(e,t,t.childCount+1);this.write(s)})(),this}renderList(t,e,s){n(this,ht)&&n(this,ht).type===t.type&&this.flushClose(2),t.forEach(((n,i,o)=>{this.wrapBlock(e,t,(()=>this.render(n,t,o)),s(o))}))}get atBlank(){return/(^|\n)$/.test(n(this,ct))}serializeMarks(t,e,s,n=!1){return t.map((t=>this.markString(t,e,s,n))).join("")}flushClose(t=1){if(!n(this,ht))return this;this.atBlank||s(this,ct,n(this,ct)+"\n");const e=this.utils.removeWhiteSpaceAfter(n(this,dt));return s(this,ct,n(this,ct)+this.utils.repeat(e+"\n",t)),s(this,ht,!1),this}markString(t,e,s,n=!1){const i=this.getMark(t),o=n?i.open:i.close;return"string"==typeof o?o:o(this,t,e,s)}render(t,e,s){this.getNode(t)(this,t,e,s)}compareMarkPriority(t=!1){return(e,s)=>{var n,i,o,r;const a=null!==(i=null===(n=this.getMark(e))||void 0===n?void 0:n.priority)&&void 0!==i?i:0,l=null!==(r=null===(o=this.getMark(s))||void 0===o?void 0:o.priority)&&void 0!==r?r:0;return t?a-l:l-a}}getMark(t){const e=n(this,pt)[t.type.name];if(!e)throw new Error(`Fail to get mark ${t.type.name} from mark map.`);return e}getNode(t){const e=n(this,ut)[t.type.name];if(!e)throw new Error(`Fail to get node ${t.type.name} from node map.`);return e}}ct=new WeakMap,dt=new WeakMap,ht=new WeakMap,ut=new WeakMap,pt=new WeakMap;class _t extends mt{constructor(){super(...arguments),this.id="serializerLoader",this.type=ot.Internal,this.loadAfter=at.SchemaReady}main(){const t=function(t,e){return s=>{const n=new Ct(t,e);return n.exec(s),n.output}}(wt(this.context.nodes,(t=>[t.id,t.serializer]),{text(t,e){const{text:s}=e;s&&t.text(s)}}),wt(this.context.marks,(t=>[t.id,t.serializer])));this.updateContext({serializer:t})}}class $t extends mt{constructor(){super(...arguments),this.id="inputRulesLoader",this.type=ot.Internal,this.loadAfter=at.SchemaReady}main(){const{nodes:t,marks:e,schema:s}=this.context,n=[...t.filter((t=>Boolean(t.inputRules))).reduce(((t,e)=>{const n=s.nodes[e.id];return n?[...t,...e.inputRules(n,s)]:t}),[]),...e.filter((t=>Boolean(t.inputRules))).reduce(((t,e)=>{const n=s.marks[e.id];return n?[...t,...e.inputRules(n,s)]:t}),[])];this.updateContext({inputRules:n})}}class Ot extends mt{constructor(){super(...arguments),this.id="keymapLoader",this.type=ot.Internal,this.loadAfter=at.SchemaReady}main(){const{nodes:t,marks:e,schema:s}=this.context,n=[...t.filter((t=>Boolean(t.keymap))).map((t=>{const e=s.nodes[t.id];if(!e)throw new Error;return t.keymap(e)})),...e.filter((t=>Boolean(t.keymap))).map((t=>{const e=s.marks[t.id];if(!e)throw new Error;return t.keymap(e)}))].map((t=>i(t)));this.updateContext({keymap:n})}}class St extends mt{constructor(){super(...arguments),this.id="nodeViewsLoader",this.type=ot.Internal,this.loadAfter=at.SchemaReady}main(){const{nodes:t,marks:e,schema:s,editor:n}=this.context,i=t.filter((t=>Boolean(t.view))).reduce(((t,e)=>{const i=s.nodes[e.id];if(!i)throw new Error;return Object.assign(Object.assign({},t),{[e.id]:(...t)=>e.view(n,i,...t)})}),{}),o=e.filter((t=>Boolean(t.view))).reduce(((t,e)=>{const i=s.marks[e.id];if(!i)throw new Error;return Object.assign(Object.assign({},t),{[e.id]:(...t)=>e.view(n,i,...t)})}),{}),r=Object.assign(Object.assign({},i),o);this.updateContext({nodeViews:r})}}class Rt extends mt{constructor(){super(...arguments),this.id="viewLoader",this.type=ot.Internal,this.loadAfter=at.PluginReady}main(){const{nodeViews:t,serializer:e}=this.context,{listener:s,editable:n}=this.options,i=this.createState(),r=this.createViewContainer(),a=new o(r,{state:i,nodeViews:t,editable:n,dispatchTransaction:t=>{var n,i;const o=a.state.apply(t);a.updateState(o),null===(n=s.markdown)||void 0===n||n.forEach((t=>{t((()=>e(a.state.doc)))})),null===(i=s.doc)||void 0===i||i.forEach((t=>{t(a.state.doc)}))}});this.prepareViewDom(a.dom),this.updateContext({editorView:a})}createState(){const{parser:t,schema:e,inputRules:s,keymap:n,prosemirrorPlugins:o}=this.context,{defaultValue:u}=this.options,p=t(u);return r.create({schema:e,doc:p,plugins:[a(),i({"Mod-z":l,"Shift-Mod-z":c}),...n,...o,i(d),h({rules:s})]})}createViewContainer(){const{root:t}=this.options,e=document.createElement("div");return e.className="milkdown",t.appendChild(e),e}prepareViewDom(t){t.classList.add("editor"),t.setAttribute("role","textbox")}}const Tt=t=>class extends mt{constructor(){super(...arguments),this.id=t,this.type=ot.ProsemirrorPlugin,this.loadAfter=at.SchemaReady}main(){this.updateContext({prosemirrorPlugins:this.context.prosemirrorPlugins.concat(...this.options.plugins(this.context))})}},It=(t,e)=>new(Tt(t))({plugins:e}),Pt=t=>class extends mt{constructor(){super(...arguments),this.id=t,this.type=ot.ProsemirrorPlugin,this.loadAfter=at.SchemaReady}main(){const t=this.options.plugins(this.context).reduce(((t,e)=>Array.isArray(e)?t.use(...e):t.use(e)),this.context.markdownIt);this.updateContext({markdownIt:t})}},Nt=(t,e)=>new(Pt(t))({plugins:e}),Dt=t=>class extends mt{constructor(){super(...arguments),this.id=t,this.type=ot.ProsemirrorPlugin,this.loadAfter=at.SchemaReady}main(){const t=this.options.rules(this.context),e=this.context.markdownIt.enable(t);this.updateContext({markdownIt:e})}};class Bt{constructor(t){this.atoms=[],this.ctx={loadState:at.Idle,markdownIt:new u("commonmark"),nodes:[],marks:[],editor:this,prosemirrorPlugins:[]},this.updateCtx=t=>{Object.assign(this.ctx,t)};const e=Object.assign({root:document.body,defaultValue:"",listener:{}},t);this.use([new kt,new Et,new _t,new Ot,new $t,new St,new Rt(e)])}injectCtx(){this.atoms.forEach((t=>t.injectContext(this.ctx,this.updateCtx)))}runAtomByLoadState(t){this.atoms.filter((e=>e.loadAfter===t)).forEach((t=>{t.main()}))}addAtom(t){const e=this.atoms.findIndex((e=>e.id===t.id));e>=0&&(console.warn(`Atom: ${t.id} is conflicted with previous atom, the previous one will be override.`),this.atoms.splice(e,1)),this.atoms.push(t)}use(t){return Array.isArray(t)?(t.forEach((t=>{this.addAtom(t)})),this):(this.addAtom(t),this)}create(){this.injectCtx(),[at.Idle,at.LoadSchema,at.SchemaReady,at.PluginReady,at.Complete].forEach((t=>{this.ctx.loadState=t,this.runAtomByLoadState(t)}))}}function jt(t,e){return new p(t,((t,s,n,i)=>{const{tr:o}=t,r=s.length;let a=n,l=i;if(s[r-1]){const c=s[0],d=s[r-1],h=s[r-2],u=n+c.indexOf(h),p=u+h.length-1,m=u+h.lastIndexOf(d),f=m+d.length;if(function(t,e,s){let n=[];return s.doc.nodesBetween(t,e,((t,e)=>{n=[...n,...t.marks.map((s=>({start:e,end:e+t.nodeSize,mark:s})))]})),n}(n,i,t).filter((t=>t.mark.type.excludes(e))).filter((t=>t.end>u)).length)return null;f<p&&o.delete(f,p),m>u&&o.delete(u,m),a=u,l=a+d.length}return o.addMark(a,l,e.create()),o.removeStoredMark(e),o}))}const Wt=[new class extends ft{constructor(){super(...arguments),this.id="link",this.schema={attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:t=>({href:t.getAttribute("href"),title:t.getAttribute("title")})}],toDOM:t=>["a",Object.assign(Object.assign({},t.attrs),{class:"link"})]},this.parser={mark:"link",getAttrs:t=>({href:t.attrGet("href"),title:t.attrGet("title")||null})},this.serializer={open:()=>"[",close:(t,e)=>`](${t.utils.escape(e.attrs.href)}${e.attrs.title?` ${t.utils.quote(e.attrs.title)}`:""})`,priority:1},this.inputRules=(t,e)=>[new p(/\[(?<text>.+?)]\((?<href>.*?)(?=“|\))"?(?<title>[^"]+)?"?\)/,((s,n,i,o)=>{const[r,a="",l,c]=n,{tr:d}=s;return r&&d.replaceWith(i,o,e.text(a)).addMark(i,a.length+i,t.create({title:c,href:l})),d}))]}},new class extends ft{constructor(){super(...arguments),this.id="strong",this.schema={parseDOM:[{tag:"b"},{tag:"strong"},{style:"font-style",getAttrs:t=>"bold"===t}],toDOM:()=>["strong",{class:"strong"}]},this.parser={mark:this.id},this.serializer={open:"**",close:"**"},this.inputRules=t=>[jt(/(?:__)([^_]+)(?:__)$/,t),jt(/(?:\*\*)([^*]+)(?:\*\*)$/,t)],this.keymap=t=>({"Mod-b":m(t)})}},new class extends ft{constructor(){super(...arguments),this.id="code_inline",this.schema={excludes:"_",parseDOM:[{tag:"code"}],toDOM:()=>["code",{class:"code-inline"}]},this.parser={mark:"code_inline",isAtom:!0},this.serializer={open:"`",close:"`"},this.inputRules=t=>[jt(/(?:^|[^`])(`([^`]+)`)$/,t)]}},new class extends ft{constructor(){super(...arguments),this.id="em",this.schema={parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style",getAttrs:t=>"italic"===t}],toDOM:()=>["em",{class:"em"}]},this.parser={mark:"em"},this.serializer={open:"*",close:"*"},this.inputRules=t=>[jt(/(?:^|[^_])(_([^_]+)_)$/,t),jt(/(?:^|[^*])(\*([^*]+)\*)$/,t)],this.keymap=t=>({"Mod-i":m(t)})}}];const zt=Array(5).fill(0).map(((t,e)=>e+1));const Ht=["","javascript","typescript","bash","sql","json","c","cpp","java","ruby","python","go","rust"];const Ft=[new class extends gt{constructor(){super(...arguments),this.id="paragraph",this.schema={content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>["p",{class:"paragraph"},0]},this.parser={block:this.id},this.serializer=(t,e)=>{t.renderInline(e).closeBlock(e)}}},new class extends gt{constructor(){super(...arguments),this.id="hardbreak",this.schema={inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br",{class:"bard-break"}]},this.parser={block:this.id,isAtom:!0},this.serializer=t=>{t.write("  \n")},this.keymap=t=>({"Shift-Enter":(e,s)=>(null==s||s(e.tr.replaceSelectionWith(t.create()).scrollIntoView()),!0)})}},new class extends gt{constructor(){super(...arguments),this.id="blockquote",this.schema={content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",{class:"blockquote"},0]},this.parser={block:this.id},this.serializer=(t,e)=>{t.wrapBlock("> ",e,(()=>t.renderContent(e)))},this.inputRules=t=>[f(/^\s*>\s$/,t)]}},new class extends gt{constructor(){super(...arguments),this.id="fence",this.schema={content:"text*",group:"block",marks:"",defining:!0,code:!0,attrs:{language:{default:""}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:t=>({language:t.dataset.language})}],toDOM:t=>{const e=this.createSelectElement(t.attrs.language);return["div",{"data-language":t.attrs.language,class:"code-fence"},["div",{contentEditable:"false"},e],["pre",["code",{spellCheck:"false"},0]]]}},this.parser={block:this.id,getAttrs:t=>({language:t.info}),isAtom:!0},this.serializer=(t,e)=>{t.write("```"+e.attrs.language+"\n"),t.text(e.textContent),t.ensureNewLine(),t.write("```"),t.closeBlock(e)},this.inputRules=t=>[g(/^```$/,t)],this.keymap=()=>({Tab:(t,e)=>{const{tr:s,selection:n}=t;return!!e&&(e(s.insertText("  ",n.from,n.to)),!0)}})}onChangeLanguage(t,e,s){const{editorView:n}=this.context,i=n.posAtCoords({top:t,left:e});if(!i)return;const o=n.state.tr.setNodeMarkup(i.inside,void 0,{language:s});n.dispatch(o)}createSelectElement(t){const e=document.createElement("select");return e.className="code-fence_select",e.addEventListener("mousedown",(t=>{const{editorView:e}=this.context;e.editable||t.preventDefault()})),e.addEventListener("change",(t=>{if(this.context.loadState!==at.Complete)throw new Error("Should not trigger event before milkdown ready.");const e=t.target;if(!e)return;const{top:s,left:n}=e.getBoundingClientRect();this.onChangeLanguage(s,n,e.value)})),Ht.forEach((s=>{const n=document.createElement("option");n.className="code-fence_select-option",n.value=s,n.innerText=s||"--",n.selected=t===s,e.appendChild(n)})),e}},new class extends gt{constructor(){super(...arguments),this.id="ordered_list",this.schema={content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:t=>({order:t.hasAttribute("start")?Number(t.getAttribute("start")):1})}],toDOM:t=>["ol",Object.assign(Object.assign({},1===t.attrs.order?{}:t.attrs.order),{class:"ordered-list"}),0]},this.parser={block:this.id},this.serializer=(t,e)=>{const{order:s=1}=e.attrs,n=(""+(s+e.childCount-1)).length,i=t.utils.repeat(" ",n+2);t.renderList(e,i,(e=>{const i=`${s+e}`;return t.utils.repeat(" ",n-i.length)+i+". "}))},this.inputRules=t=>[f(/^(\d+)\.\s$/,t,(t=>({order:Number(t[1])})),((t,e)=>e.childCount+e.attrs.order===Number(t[1])))]}},new class extends gt{constructor(){super(...arguments),this.id="bullet_list",this.schema={content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",{class:"bullet-list"},0]},this.parser={block:this.id},this.serializer=(t,e)=>{t.renderList(e,"  ",(()=>"* "))},this.inputRules=t=>[f(/^\s*([-+*])\s$/,t)]}},new class extends gt{constructor(){super(...arguments),this.id="list_item",this.schema={content:"paragraph block*",defining:!0,parseDOM:[{tag:"li"}],toDOM:()=>["li",{class:"list-item"},0]},this.parser={block:this.id},this.serializer=(t,e)=>{t.renderContent(e)},this.keymap=t=>({Enter:w(t),"Mod-]":v(t),"Mod-[":k(t)})}},new class extends gt{constructor(){super(...arguments),this.id="heading",this.schema={content:"text*",group:"block",attrs:{level:{default:1}},parseDOM:zt.map((t=>({tag:`h${t}`,attrs:{level:t}}))),toDOM:t=>[`h${t.attrs.level}`,{class:`heading h${t.attrs.level}`},0]},this.parser={block:this.id,getAttrs:t=>({level:Number(t.tag.slice(1))})},this.serializer=(t,e)=>{t.write(`${t.utils.repeat("#",e.attrs.level)} `),t.renderInline(e),t.closeBlock(e)},this.inputRules=t=>zt.map((e=>g(new RegExp(`^(#{1,${e}})\\s$`),t,(()=>({level:e})))))}},new class extends gt{constructor(){super(...arguments),this.id="hr",this.schema={group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr",{class:"hr"}]},this.parser={block:this.id,isAtom:!0},this.serializer=(t,e)=>{t.write("---"),t.closeBlock(e)},this.inputRules=t=>[new p(/^(?:---|___\s|\*\*\*\s)$/,((e,s,n,i)=>{const{tr:o}=e;return s[0]&&o.replaceWith(n,i,t.create({})),o}))]}},new class extends gt{constructor(){super(...arguments),this.id="image",this.schema={inline:!0,attrs:{src:{default:""},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,marks:"",parseDOM:[{tag:"img[src]",getAttrs:t=>{if(!(t instanceof HTMLElement))throw new Error;return{src:t.getAttribute("src")||"",alt:t.getAttribute("alt"),title:t.getAttribute("title")}}}],toDOM:t=>{var e;return(null===(e=t.attrs.src)||void 0===e?void 0:e.length)>0?["img",Object.assign(Object.assign({},t.attrs),{class:"image"})]:["div",Object.assign(Object.assign({},t.attrs),{class:"image empty"}),["span",{contentEditable:"false",class:"icon"}],["span",{contentEditable:"false",class:"placeholder"}]]}},this.parser={node:"image",getAttrs:t=>{var e,s;return{src:t.attrGet("src")||"",alt:(null===(s=null===(e=t.children)||void 0===e?void 0:e[0])||void 0===s?void 0:s.content)||null,title:t.attrGet("title")}}},this.serializer=(t,e)=>{const s=t.utils.escape(e.attrs.alt||""),n=e.attrs.title?" "+t.utils.quote(e.attrs.title):"",i=t.utils.escape(e.attrs.src)+n;t.write(`![${s}](${i}) `)},this.inputRules=t=>[new p(/!\[(?<alt>.*?)]\((?<filename>.*?)(?=“|\))"?(?<title>[^"]+)?"?\)/,((e,s,n,i)=>{const[o,r,a="",l]=s,{tr:c}=e;return o&&c.replaceWith(n,i,t.create({src:a,alt:r,title:l})),c}))]}},new class extends gt{constructor(){super(...arguments),this.id="tab_indent",this.schema={group:"inline",inline:!0,selectable:!1,parseDOM:[{tag:"span[class='tab-indent']"}],toDOM:()=>["span",{class:"tab-indent"},"  "]},this.parser={block:this.id},this.serializer=t=>{t.write("  ")},this.keymap=t=>({Tab:(e,s)=>{const{selection:n}=e.tr,i=Boolean(e.tr);if(!n)return i;const{from:o,to:r}=n;if(o!==r||!t)return i;const a=e.tr.replaceSelectionWith(t.create()).scrollIntoView();return null==s||s(a),Boolean(a)}})}}],Vt=t=>e=>{const{$from:s}=e;for(let n=s.depth;n>0;n--){const e=s.node(n);if(t(e))return{pos:n>0?s.before(n):0,start:s.start(n),depth:n,node:e}}},qt=t=>(e,s)=>{let n;const{from:i,to:o}=e;return s.nodesBetween(i,o,((e,s)=>{if(n)return!1;t(e)&&(n={node:e,pos:s})})),n},Ut=t=>Object.assign(Object.create(t),t).setTime(Date.now()),Gt=(Yt=t=>t.isBlock,(t,e)=>((t,e=!0)=>{const s=[];return t.descendants(((t,n)=>{if(s.push({node:t,pos:n}),!e)return!1})),s})(t,e).filter((t=>Yt(t.node))));var Yt;const Kt={};const Qt="MILKDOWN_PLUGIN_PRISM";function Xt(t){let e=!1;return new M({key:new A(Qt),state:{init:(t,{doc:e})=>b.create(e,[]),apply:(s,n,i,o)=>{const r=o.selection.$head.parent.type.name===t,a=i.selection.$head.parent.type.name===t,l=s.docChanged&&(r||a);return!e||l?(e=!0,function(t,e){const s=[],n=Gt(t).filter((t=>t.node.type.name===e));return n.forEach((t=>{var e;let n=t.pos+1;const i=t.node.attrs.language;if(i){if(!(null===(e=Kt[t.pos])||void 0===e?void 0:e.node.eq(t.node))){const e=y.highlight(t.node.textContent,i),s=(t,e=[])=>t.flatMap((t=>"element"===t.type?s(t.children,[...e,...t.properties.className||[]]):[{text:t.value,className:e}])),o=s(e).map((({text:t,className:e})=>{const s=n,i=s+t.length;return n=i,x.inline(s,i,{class:e.join(" ")})}));Kt[t.pos]={node:t.node,dec:o}}Kt[t.pos].dec.forEach((t=>{s.push(t)}))}})),Object.keys(Kt).filter((t=>!n.find((e=>e.pos===Number(t))))).forEach((t=>{delete Kt[Number(t)]})),b.create(t,s)}(s.doc,t)):n.map(s.mapping,s.doc)}},view:t=>(window.requestAnimationFrame((()=>{t.dispatch(t.state.tr.setMeta(Qt,{loaded:!0}))})),{}),props:{decorations(t){return this.getState(t)}}})}const Jt=It("prism",(()=>[Xt("fence")])),Zt=(t,e)=>t.tagName===e.toUpperCase(),te=t=>{const e=document.createElement("span");return e.textContent=t,e.className="icon material-icons",e},ee=(t,e)=>{const{from:s,to:n}=t.selection;return t.doc.rangeHasMark(s,n,e)},se=(t,e)=>{var s;return null===(s=qt((t=>Boolean(e.isInSet(t.marks))))(t.selection,t.doc))||void 0===s?void 0:s.node},ne=(t,e)=>!(t=>t.selection instanceof E)(t)||(t=>Boolean(Vt((t=>"fence"===t.type.name))(t.selection)))(t)||ee(t,e),ie=(t,e,s)=>(n,i)=>{if(!i)return!1;const{start:o,end:r}=((t,e)=>{let s={start:-1,end:-1};const n=qt((t=>Boolean(e.isInSet(t.marks))))(t.selection,t.doc);return n&&(s={start:n.pos,end:n.pos+Math.max(n.node.textContent.length,1)}),s})(n,t),{tr:a}=n,l=e.create(Object.assign(Object.assign({},t.attrs),{href:s}));return a.removeMark(o,r).addMark(o,r,l).setSelection(new E(a.selection.$anchor)),i(a.scrollIntoView()),!0},oe=(t,e)=>(s,n)=>{const{target:i}=s,{nodes:o}=t,{image:r}=o;if(!(i instanceof HTMLElement))return()=>!0;if(Zt(i,"input"))return i.focus(),()=>!1;const a=re(n.state.selection,r);if(!a)return()=>!1;const l=i.parentNode;if(!l)return()=>!1;const c=Array.from(l.children).find((t=>"INPUT"===t.tagName));return c instanceof HTMLInputElement?(t,s)=>{if(!s)return!1;const{tr:n}=t;return n.setNodeMarkup(a.pos,void 0,Object.assign(Object.assign({},a.node.attrs),{[e]:c.value})),s(n.scrollIntoView()),!0}:()=>!1},re=(t,e)=>{if(!(t instanceof L))return;const{node:s,$from:n}=t;return((t,e)=>Array.isArray(t)&&t.indexOf(e.type)>-1||e.type===t)(e,s)?{node:s,pos:n.pos,depth:n.depth}:void 0},ae=(t,e,s,n)=>({$:te(t),command:()=>m(e,n),active:t=>ee(t.state,e),disable:t=>ne(t.state,s)});var le,ce,de,he;(ce=le||(le={}))[ce.ToggleBold=0]="ToggleBold",ce[ce.ToggleItalic=1]="ToggleItalic",ce[ce.ToggleCode=2]="ToggleCode",ce[ce.ToggleLink=3]="ToggleLink",(he=de||(de={}))[he.ModifyLink=0]="ModifyLink",he[he.ModifyImage=1]="ModifyImage";var ue,pe,me,fe,ge,we,ve,ke;class be{constructor(t,e){this.view=e,ue.set(this,void 0),pe.set(this,void 0),me.set(this,(t=>{const{view:e}=this;if(!e)return;const s=Object.values(n(this,pe)).find((({$:e})=>t.target instanceof Element&&e.contains(t.target)));s&&(t.stopPropagation(),t.preventDefault(),s.command(t,e)(e.state,e.dispatch))})),s(this,pe,t),s(this,ue,this.createTooltip()),n(this,ue).addEventListener("mousedown",n(this,me))}destroy(){n(this,ue).removeEventListener("mousedown",n(this,me)),n(this,ue).remove()}hide(){n(this,ue).classList.add("hide")}update(t){this.filterButton(t)?this.hide():this.calcPos(t)}get noActive(){return Object.values(n(this,pe)).every((({$:t})=>t.classList.contains("hide")))}filterButton(t){return Object.values(n(this,pe)).forEach((e=>{var s;if(null===(s=e.disable)||void 0===s?void 0:s.call(e,t))return void e.$.classList.add("hide");e.$.classList.remove("hide");e.active(t)?e.$.classList.add("active"):e.$.classList.remove("active")})),this.noActive}calcPos(t){var e;n(this,ue).classList.remove("hide");const s=t.state,{from:i,to:o}=s.selection,r=t.coordsAtPos(i),a=t.coordsAtPos(o),l=Math.max((r.left+a.left)/2,r.left+3),c=null===(e=n(this,ue).offsetParent)||void 0===e?void 0:e.getBoundingClientRect();c&&(n(this,ue).style.left=l-c.left+"px",n(this,ue).style.bottom=c.bottom-r.top+"px")}createTooltip(){var t;const e=document.createElement("div");return e.className="tooltip",Object.values(n(this,pe)).forEach((({$:t})=>e.appendChild(t))),null===(t=this.view.dom.parentNode)||void 0===t||t.appendChild(e),e}}ue=new WeakMap,pe=new WeakMap,me=new WeakMap;class ye{constructor(t,e){this.view=e,fe.set(this,void 0),ge.set(this,void 0),we.set(this,void 0),this.listener=t=>{const{view:e}=this,s=n(this,we);e&&s&&(t.stopPropagation(),s(t,e)(e.state,e.dispatch))},s(this,ge,t),s(this,fe,this.createInput()),n(this,fe).addEventListener("mousedown",this.listener)}destroy(){n(this,fe).removeEventListener("mousedown",this.listener),n(this,fe).remove()}hide(){n(this,fe).classList.add("hide"),s(this,we,void 0)}update(t){this.filterInput(t)&&this.calcPos(t)}calcPos(t){var e;const s=t.state,{from:i,to:o}=s.selection,r=t.coordsAtPos(i),a=t.coordsAtPos(o),l=Math.max((r.left+a.left)/2,r.left+3),c=n(this,fe).getBoundingClientRect(),d=null===(e=n(this,fe).offsetParent)||void 0===e?void 0:e.getBoundingClientRect();if(!d)return;const h=l-d.left-c.width/2,u=h+c.width;n(this,fe).style.left=(u>d.width?h-(u-d.width):h<0?l-d.left:h)+"px",n(this,fe).style.bottom=d.bottom-r.bottom-c.height-10+"px"}createInput(){var t;const e=document.createElement("div");e.className="tooltip-input";const s=document.createElement("input");e.appendChild(s);const n=document.createElement("button");return n.textContent="APPLY",e.appendChild(n),null===(t=this.view.dom.parentNode)||void 0===t||t.appendChild(e),e}filterInput(t){var e;const i=Object.values(n(this,ge)).find((e=>e.display(t)));return i?(n(this,fe).classList.remove("hide"),s(this,we,i.command),null===(e=n(this,fe).firstElementChild)||void 0===e||e.setAttribute("placeholder",i.placeholder),i.update(t,n(this,fe)),!0):(n(this,fe).classList.add("hide"),!1)}}fe=new WeakMap,ge=new WeakMap,we=new WeakMap;class xe{constructor(t,e,n){ve.set(this,void 0),ke.set(this,void 0),s(this,ve,new be(t,n)),s(this,ke,new ye(e,n)),this.update(n)}update(t,e){if(!t.editable)return void this.hide();const s=t.state;if(s.selection.empty)return void this.hide();(null==e?void 0:e.doc.eq(s.doc))&&e.selection.eq(s.selection)||(n(this,ve).update(t),n(this,ke).update(t))}destroy(){n(this,ve).destroy(),n(this,ke).destroy()}hide(){n(this,ve).hide(),n(this,ke).hide()}}ve=new WeakMap,ke=new WeakMap;const Me=t=>new M({key:new A("MILKDOWN_PLUGIN_TOOLTIP"),view:e=>new xe((t=>{const{marks:e}=t.schema;return{[le.ToggleBold]:ae("format_bold",e.strong,e.code_inline),[le.ToggleItalic]:ae("format_italic",e.em,e.code_inline),[le.ToggleCode]:ae("code",e.code_inline,e.link),[le.ToggleLink]:ae("link",e.link,e.code_inline,{href:""})}})(t),(t=>{const{marks:e,nodes:s}=t.schema;return{[de.ModifyLink]:{display:t=>ee(t.state,e.link),command:(n=t.schema,(t,e)=>{var s;const{target:i}=t,{marks:o}=n,{link:r}=o;if(!(i instanceof HTMLElement))return()=>!0;if(Zt(i,"input"))return i.focus(),()=>!1;const a=se(e.state,r);if(!a)return()=>!1;const l=a.marks.find((({type:t})=>t===r));if(!l)return()=>!1;const c=null===(s=i.parentNode)||void 0===s?void 0:s.firstChild;return c instanceof HTMLInputElement?ie(l,o.link,c.value):()=>!1}),placeholder:"Input Web Link",update:(t,s)=>{const{firstChild:n}=s;if(!(n instanceof HTMLInputElement))return;const i=se(t.state,e.link);if(!i)return;const o=i.marks.find((t=>t.type===e.link));o&&(n.value=o.attrs.href)}},[de.ModifyImage]:{display:t=>Boolean(re(t.state.selection,s.image)),command:oe(t.schema,"src"),placeholder:"Input Image Link",update:(t,e)=>{const{firstChild:n}=e;if(!(n instanceof HTMLInputElement))return;const i=re(t.state.selection,s.image);i&&(n.value=i.node.attrs.src)}}};var n})(t),e)}),Ae=It("tooltip",(t=>[Me(t)]));const Ee=[new class extends gt{constructor(){super(...arguments),this.id="math_inline",this.schema={group:"inline math",content:"text*",inline:!0,atom:!0,parseDOM:[{tag:"math-inline"}],toDOM:()=>["math-inline",{class:"math-node"},0]},this.parser={block:this.id,isAtom:!0},this.serializer=(t,e)=>{t.write("$"),t.renderContent(e),t.write("$")},this.inputRules=t=>[C($,t)]}},new class extends gt{constructor(){super(...arguments),this.id="math_display",this.schema={group:"block math",content:"text*",atom:!0,code:!0,parseDOM:[{tag:"math-display"}],toDOM:()=>["math-display",{class:"math-node"},0]},this.parser={block:"math_block",isAtom:!0},this.serializer=(t,e)=>{t.write("$$").ensureNewLine().renderContent(e).ensureNewLine().write("$$").closeBlock(e)},this.inputRules=t=>[_(O,t)]}}],Le=i({Backspace:S(T,I,P,N)}),Ce=[...Ee,It("mathProsemirrorPlugin",(()=>[R,Le])),Nt("mathMarkdownItPlugin",(()=>[D]))],_e=t=>Vt((t=>"table"===t.type.spec.tableRole))(t),$e=(t,e=3,s=3)=>{const{cell:n,header_cell:i,row:o,table:r}=B(t),a=Array(s).fill(0).map((()=>n.createAndFill(null))),l=Array(s).fill(0).map((()=>i.createAndFill(null))),c=Array(e).fill(0).map(((t,e)=>o.create(null,0===e?l:a)));return r.create(null,c)},Oe=t=>e=>s=>{const n=_e(s.selection),i="row"===t;if(n){const t=j.get(n.node);if(e>=0&&e<(i?t.height:t.width)){const o=t.positionAt(i?e:t.height-1,i?t.width-1:e,n.node),r=s.doc.resolve(n.start+o),a=i?W.rowSelection:W.colSelection,l=t.positionAt(i?e:0,i?0:e,n.node),c=s.doc.resolve(n.start+l);return Ut(s.setSelection(a(r,c)))}}return s},Se=t=>{const e=(t=>{const e=_e(t);if(!e)return;const s=j.get(e.node);return s.cellsInRect({left:0,right:s.width,top:0,bottom:s.height}).map((t=>{const s=e.node.nodeAt(t),n=t+e.start;return{pos:n,start:n+1,node:s}}))})(t.selection);if(e){const s=t.doc.resolve(e[0].pos),n=t.doc.resolve(e[e.length-1].pos);return Ut(t.setSelection(new W(n,s)))}return t},Re=z({tableGroup:"block",cellContent:"table_inline",cellAttributes:{alignment:{default:"left",getFromDOM:t=>t.style.textAlign||"left",setDOMAttr:(t,e)=>{e.style=`text-align: ${t||"left"}`}}}});const Te=[new class extends gt{constructor(){super(...arguments),this.id="table",this.schema=Re.table,this.parser={block:this.id},this.serializer=(t,e)=>{let s="";t.ensureNewLine(),e.forEach(((e,n,i)=>{s&&(t.write(`${s}|\n`),s=""),e.forEach(((e,n,o)=>{if(t.write(0===o?"| ":" | "),t.renderContent(e),0===i)switch(e.attrs.alignment){case"center":return void(s+="|:---:");case"left":return void(s+="|:---");case"right":return void(s+="|---:");default:return void(s+="|----")}})),t.write(" |\n")})),t.closeBlock(e)},this.inputRules=(t,e)=>[new p(/^\|\|\s$/,((s,n,i,o)=>{const r=s.doc.resolve(i);if(!r.node(-1).canReplaceWith(r.index(-1),r.indexAfter(-1),t))return null;const a=$e(e),l=s.tr.replaceRangeWith(i,o,a).scrollIntoView();return l.setSelection(E.create(l.doc,i+3))}))]}},new class extends gt{constructor(){super(...arguments),this.id="table_row",this.schema=Re.table_row,this.parser={block:"tr"},this.serializer=()=>{}}},new class extends gt{constructor(){super(...arguments),this.id="table_cell",this.schema=Re.table_cell,this.parser={block:"td",getAttrs:t=>({alignment:t.info})},this.serializer=()=>{}}},new class extends gt{constructor(){super(...arguments),this.id="table_header",this.schema=Re.table_header,this.parser={block:"th",getAttrs:t=>({alignment:t.info})},this.serializer=()=>{}}},new class extends gt{constructor(){super(...arguments),this.id="table_inline",this.schema={content:"inline*",group:"block",parseDOM:[{tag:"span"}],toDOM:()=>["span",{class:"table-inline"},0]},this.parser={block:this.id},this.serializer=(t,e)=>{t.renderInline(e)}}}];var Ie,Pe,Ne,De,Be,je,We,ze;function He(t){const e=document.createElement("span");return e.textContent=t,e.className="icon material-icons material-icons-outlined",e}(je=Be||(Be={})).Left="Left",je.Top="Top",je.Point="Point",(ze=We||(We={}))[ze.AddColLeft=0]="AddColLeft",ze[ze.AddColRight=1]="AddColRight",ze[ze.AddRowTop=2]="AddRowTop",ze[ze.AddRowBottom=3]="AddRowBottom",ze[ze.AlignLeft=4]="AlignLeft",ze[ze.AlignCenter=5]="AlignCenter",ze[ze.AlignRight=6]="AlignRight",ze[ze.Delete=7]="Delete";const Fe=t=>t.state.selection;var Ve,qe;(qe=Ve||(Ve={})).Col="Col",qe.Row="Row",qe.All="All";const Ue=t=>{const e=Fe(t),s=e.isRowSelection(),n=e.isColSelection();return s&&n?Ve.All:s?Ve.Row:Ve.Col};class Ge{constructor(){Ie.set(this,[]),Pe.set(this,void 0),Ne.set(this,void 0),De.set(this,{[We.AddColLeft]:{$:He("chevron_left"),command:()=>H,disable:t=>Ue(t)!==Ve.Col},[We.AddColRight]:{$:He("chevron_right"),command:()=>F,disable:t=>Ue(t)!==Ve.Col},[We.AddRowTop]:{$:He("expand_less"),command:()=>V,disable:t=>Ue(t)!==Ve.Row||"table_header"===Fe(t).$head.parent.type.name},[We.AddRowBottom]:{$:He("expand_more"),command:()=>q,disable:t=>Ue(t)!==Ve.Row},[We.AlignLeft]:{$:He("format_align_left"),command:()=>U("alignment","left"),disable:t=>!Fe(t).isColSelection()},[We.AlignCenter]:{$:He("format_align_center"),command:()=>U("alignment","center"),disable:t=>!Fe(t).isColSelection()},[We.AlignRight]:{$:He("format_align_right"),command:()=>U("alignment","right"),disable:t=>!Fe(t).isColSelection()},[We.Delete]:{$:He("delete"),command:(t,e)=>{const s=Fe(e),n=s.isColSelection(),i=s.isRowSelection();return n&&i?G:n?Y:K}}}),this.key=new A("TABLE_OP"),this.decorations=t=>{const e=(s=0,t=>{const e=_e(t);if(!e)return;const n=j.get(e.node);return s<0||s>=n.width?void 0:n.cellsInRect({left:s,right:s+1,top:0,bottom:n.height}).map((t=>{const s=e.node.nodeAt(t);if(!s)throw new Error;const n=t+e.start;return{pos:n,start:n+1,node:s}}))})(t.selection);var s;if(!e)return null;const i=(o=0,t=>{const e=_e(t);if(!e)return;const s=j.get(e.node);return o<0||o>=s.height?void 0:s.cellsInRect({left:0,right:s.width,top:o,bottom:o+1}).map((t=>{const s=e.node.nodeAt(t);if(!s)throw new Error;const n=t+e.start;return{pos:n,start:n+1,node:s}}))})(t.selection);var o;if(!i)return null;const[r]=e;return this.createWidget(r,Be.Point),e.forEach(((t,e)=>{this.createWidget(t,Be.Left,e)})),i.forEach(((t,e)=>{this.createWidget(t,Be.Top,e)})),b.create(t.doc,n(this,Ie))},this.update=(t,e)=>{const s=t.state;if((null==e?void 0:e.doc.eq(s.doc))&&e.selection.eq(s.selection))return;s.selection instanceof W&&t.editable?(this.calculateItem(t),Object.values(n(this,De)).every((({$:t})=>t.classList.contains("hide")))?this.hide():(n(this,Pe).classList.remove("hide"),this.calculatePosition(t))):this.hide()},this.props={decorations:this.decorations},this.view=t=>{var e;return s(this,Ne,t),Object.values(n(this,De)).forEach((({$:t})=>n(this,Pe).appendChild(t))),null===(e=t.dom.parentNode)||void 0===e||e.appendChild(n(this,Pe)),this.update(t),n(this,Pe).addEventListener("mousedown",this.listener),{update:this.update,destroy:()=>{n(this,Pe).removeEventListener("mousedown",this.listener),n(this,Pe).remove()}}},this.listener=t=>{const e=n(this,Ne);e&&(t.stopPropagation(),t.preventDefault(),Object.values(n(this,De)).forEach((({$:s,command:n})=>{s.contains(t.target)&&n(t,e)(e.state,e.dispatch)})))},s(this,Pe,document.createElement("div")),n(this,Pe).classList.add("table-tooltip")}createWidget(t,e,s=0){const i=x.widget(t.pos+1,(()=>{const t=document.createElement("div");return t.classList.add(this.calculateClassName(e)),t.addEventListener("mousedown",(t=>{if(n(this,Ne))switch(t.preventDefault(),e){case Be.Point:return void n(this,Ne).dispatch(Se(n(this,Ne).state.tr));case Be.Left:return void n(this,Ne).dispatch(Oe("row")(s)(n(this,Ne).state.tr));case Be.Top:return void n(this,Ne).dispatch(Oe("col")(s)(n(this,Ne).state.tr))}})),t}));n(this,Ie).push(i)}calculateClassName(t){switch(t){case Be.Left:return"milkdown-cell-left";case Be.Top:return"milkdown-cell-top";case Be.Point:return"milkdown-cell-point";default:throw new Error}}calculatePosition(t){var e;const s=t.state.selection,i=s.isColSelection(),o=s.isRowSelection();if(!i&&!o)return;const{from:r,to:a}=s,l=t.coordsAtPos(r),c=t.coordsAtPos(a),d=Math.max((l.left+c.left)/2,l.left+3),h=null===(e=n(this,Pe).offsetParent)||void 0===e?void 0:e.getBoundingClientRect();if(!h)return;const u=d-h.left-(o?8:-t.domAtPos(r).node.getBoundingClientRect().width/2+16),p=h.bottom-l.bottom;n(this,Pe).style.left=u+"px",n(this,Pe).style.bottom=p+"px"}calculateItem(t){Object.values(n(this,De)).forEach((e=>{var s;(null===(s=e.disable)||void 0===s?void 0:s.call(e,t))?e.$.classList.add("hide"):e.$.classList.remove("hide")}))}hide(){n(this,Pe).classList.add("hide")}}Ie=new WeakMap,Pe=new WeakMap,Ne=new WeakMap,De=new WeakMap;const Ye=/(?:^|[^\\])\\n/;function Ke(t){t.core.ruler.after("inline","milkdown-table",(t=>{const e=t.tokens;let s=!1;for(let n=e.length-1;n>0;n--){if(s&&e[n].level--,"inline"===e[n].type&&e[n].content.match(Ye)){const t=e[n].children||[];e[n].children=[],t.forEach((t=>{var s;const i=t.content.split(Ye);i.length>1&&"code_inline"!==t.type?i.forEach(((t,s)=>{var o,r;const a=new Q("text","",1);if(a.content=t.trim(),null===(o=e[n].children)||void 0===o||o.push(a),s<i.length-1){const t=new Q("br","br",1);null===(r=e[n].children)||void 0===r||r.push(t)}})):null===(s=e[n].children)||void 0===s||s.push(t)}))}if(["thead_open","thead_close","tbody_open","tbody_close"].includes(e[n].type)&&(s=!s,e.splice(n,1)),["th_open","td_open"].includes(e[n].type)){e.splice(n+1,0,new Q("table_inline_open","span",1));const t=e[n].attrs;if(t){const s=t[0][1];e[n].info=s.split(":")[1]}}["th_close","td_close"].includes(e[n].type)&&e.splice(n,0,new Q("table_inline_close","span",-1))}return!1}))}const Qe=It("milkdown-table",(t=>{return[Z({}),tt(),new M(new Ge),i({"Mod-]":et(1),"Mod-[":et(-1),"Mod-Enter":(e=t.schema.nodes.paragraph,(t,s)=>{if(!X(t))return!1;const{$head:n}=t.selection,i=n.after(),o=t.tr.replaceWith(i,i,e.createAndFill());return o.setSelection(J.near(o.doc.resolve(i),1)),null==s||s(o.scrollIntoView()),!0})})];var e}));var Xe;const Je=[...Te,(Xe=()=>["table"],new(Dt("milkdown-table-rule"))({rules:Xe})),Nt("milkdown-table-markdown",(()=>[Ke])),Qe],Ze=t=>{const e=document.createElement("span");return e.textContent=t,e.classList.add("slash-placeholder"),e},ts=(t,e)=>{const s=document.createElement("div");s.classList.add("slash-dropdown-item");const n=document.createElement("span");n.textContent=e,n.className="icon material-icons material-icons-outlined";const i=document.createElement("span");return i.textContent=t,i.className="text",s.appendChild(n),s.appendChild(i),s};var es,ss;(ss=es||(es={}))[ss.Divider=0]="Divider",ss[ss.H1=1]="H1",ss[ss.H2=2]="H2",ss[ss.H3=3]="H3",ss[ss.BulletList=4]="BulletList",ss[ss.OrderedList=5]="OrderedList",ss[ss.Quote=6]="Quote",ss[ss.CodeFence=7]="CodeFence",ss[ss.Table=8]="Table",ss[ss.DivideLine=9]="DivideLine",ss[ss.Image=10]="Image";const ns=t=>e=>(s,n)=>{if(!n)return!1;const{selection:i}=s,{$head:o}=i,r=o.pos-1-o.parent.content.size,a=s.tr.replaceWith(r,o.pos,t(e)),l=o.pos-1-o.parent.content.size+1,c=E.create(a.doc,l);return n(a.setSelection(c)),!0},is=[{type:es.H1,$:ts("Large Heading","looks_one"),command:ns((t=>t.schema.nodes.heading.create({level:1}))),keyword:["h1","large heading"]},{type:es.H2,$:ts("Medium Heading","looks_two"),command:ns((t=>t.schema.nodes.heading.create({level:2}))),keyword:["h2","medium heading"]},{type:es.H3,$:ts("Small Heading","looks_3"),command:ns((t=>t.schema.nodes.heading.create({level:3}))),keyword:["h3","small heading"]},{type:es.BulletList,$:ts("Bullet List","format_list_bulleted"),command:ns((t=>t.schema.nodes.bullet_list.createAndFill(null))),keyword:["bullet list","ul"]},{type:es.OrderedList,$:ts("Ordered List","format_list_numbered"),command:ns((t=>t.schema.nodes.ordered_list.createAndFill(null))),keyword:["ordered list","ol"]},{type:es.Image,$:ts("Image","image"),command:ns((t=>t.schema.nodes.image.createAndFill({src:""}))),keyword:["image"]},{type:es.Quote,$:ts("Quote","format_quote"),command:ns((t=>t.schema.nodes.blockquote.createAndFill(null))),keyword:["quote","blockquote"]},{type:es.Table,$:ts("Table","table_chart"),command:ns((t=>$e(t.schema))),keyword:["table"]},{type:es.CodeFence,$:ts("Code Fence","code"),command:ns((t=>t.schema.nodes.fence.createAndFill(null))),keyword:["code"]},{type:es.DivideLine,$:ts("Divide Line","horizontal_rule"),command:ns((t=>t.schema.nodes.hr.create())),keyword:["divider","hr"]}];var os,rs,as,ls,cs,ds,hs,us,ps,ms,fs;const gs=It("slash",(t=>[ws(t)])),ws=t=>new M(new bs(t));var vs,ks;(ks=vs||(vs={}))[ks.Empty=0]="Empty",ks[ks.Slash=1]="Slash";class bs{constructor(t){this.ctx=t,this.key=new A("milkdown-prosemirror-slash-plugin"),this.status=new ys,this.props=new xs(this.status),this.view=t=>new Ms(this.status,t,this.ctx)}}class ys{constructor(){os.set(this,vs.Empty),rs.set(this,""),this.activeActions=is}clearStatus(){s(this,os,vs.Empty),s(this,rs,"")}setSlash(t=""){s(this,os,vs.Slash),s(this,rs,t)}get cursorStatus(){return n(this,os)}get filter(){return n(this,rs)}}os=new WeakMap,rs=new WeakMap;class xs{constructor(t){this.status=t,this.handleKeyDown=(t,e)=>{const{cursorStatus:s,activeActions:n}=this.status;return s===vs.Slash&&0!==n.length&&(e instanceof KeyboardEvent&&!!["ArrowUp","ArrowDown","Enter"].includes(e.key))},this.decorations=t=>{const e=Vt((({type:t})=>"paragraph"===t.name))(t.selection);if(!e)return this.status.clearStatus(),null;const s=1===t.selection.$from.depth,n=0===e.node.content.size,i="/"===e.node.textContent,o=e.node.textContent.startsWith("/"),r=(e,s)=>b.create(t.doc,[x.widget(e,Ze(s))]);return s?n?(this.status.clearStatus(),r(e.pos+1,"Type / to use the slash commands...")):i?(this.status.setSlash(),r(e.pos+2,"Type to filter...")):o?(this.status.setSlash(e.node.textContent.slice(1)),null):(this.status.clearStatus(),null):(this.status.clearStatus(),null)}}}class Ms{constructor(t,e,i){as.set(this,void 0),ls.set(this,void 0),cs.set(this,void 0),ds.set(this,void 0),hs.set(this,void 0),us.set(this,(t=>{const{target:e}=t;if(!(e instanceof HTMLElement))return;const s=n(this,hs);if(!s)return;const i=Object.values(is).find((({$:t})=>t.contains(e)));i&&(t.stopPropagation(),t.preventDefault(),i.command(n(this,cs))(s.state,s.dispatch))})),ps.set(this,(t=>{const{key:e}=t;if(n(this,ds).cursorStatus!==vs.Slash)return;if(!["ArrowDown","ArrowUp","Enter"].includes(e))return;let s=n(this,ds).activeActions.findIndex((t=>t.$.classList.contains("active")));if(s<0&&(s=0),"ArrowDown"===e){const t=s===n(this,ds).activeActions.length-1?0:s+1;return n(this,ds).activeActions[s].$.classList.remove("active"),n(this,ds).activeActions[t].$.classList.add("active"),void st(n(this,ds).activeActions[t].$,{scrollMode:"if-needed",block:"nearest",inline:"nearest"})}if("ArrowUp"===e){const t=0===s?n(this,ds).activeActions.length-1:s-1;return n(this,ds).activeActions[s].$.classList.remove("active"),n(this,ds).activeActions[t].$.classList.add("active"),void st(n(this,ds).activeActions[t].$,{scrollMode:"if-needed",block:"nearest",inline:"nearest"})}n(this,ds).activeActions[s].command(n(this,cs))(n(this,hs).state,n(this,hs).dispatch),n(this,ds).activeActions[s].$.classList.remove("active")})),ms.set(this,(t=>{const e=n(this,ds).activeActions.findIndex((t=>t.$.classList.contains("active")));e>=0&&n(this,ds).activeActions[e].$.classList.remove("active");const{target:s}=t;s instanceof HTMLElement&&s.classList.add("active")})),fs.set(this,(t=>{const{target:e}=t;e instanceof HTMLElement&&e.classList.remove("active")})),s(this,ds,t),s(this,as,(()=>{const t=document.createElement("div");return t.classList.add("slash-dropdown"),t})()),s(this,cs,i),s(this,hs,e);const{parentNode:o}=e.dom;if(!o)throw new Error;s(this,ls,o),o.appendChild(n(this,as)),is.forEach((({$:t})=>{t.addEventListener("mouseenter",n(this,ms)),t.addEventListener("mouseleave",n(this,fs)),n(this,as).appendChild(t)})),n(this,ls).addEventListener("mousedown",n(this,us)),n(this,ls).addEventListener("keydown",n(this,ps))}update(t){this.renderDropdown()&&this.calculatePosition(t)}destroy(){n(this,ls).removeEventListener("mousedown",n(this,us)),n(this,ls).removeEventListener("keydown",n(this,ps)),n(this,as).remove()}renderDropdown(){const{cursorStatus:t,filter:e}=n(this,ds);if(t!==vs.Slash)return n(this,as).classList.add("hide"),!1;const s=is.filter((t=>{t.$.classList.remove("active");return!!t.keyword.some((t=>t.includes(e.toLocaleLowerCase())))||(t.$.classList.add("hide"),!1)})).map((t=>(t.$.classList.remove("hide"),t)));return n(this,ds).activeActions=s,0===s.length?(n(this,as).classList.add("hide"),!1):(s[0].$.classList.add("active"),n(this,as).classList.remove("hide"),st(s[0].$,{scrollMode:"if-needed",block:"nearest",inline:"nearest"}),!0)}calculatePosition(t){var e;const s=t.state,{from:i}=s.selection,o=t.coordsAtPos(i),r=null===(e=n(this,as).offsetParent)||void 0===e?void 0:e.getBoundingClientRect();if(!r)return;const a=n(this,as).getBoundingClientRect();if(n(this,as).style.left=o.left-r.left+"px",Math.abs(o.bottom-r.bottom)>a.height)return n(this,as).style.bottom="",void(n(this,as).style.top=o.top-r.top+20+"px");n(this,as).style.top="",n(this,as).style.bottom=o.bottom-r.bottom+190+"px"}}as=new WeakMap,ls=new WeakMap,cs=new WeakMap,ds=new WeakMap,hs=new WeakMap,us=new WeakMap,ps=new WeakMap,ms=new WeakMap,fs=new WeakMap;const As=[gs];const Es=({content:t})=>{const e=nt.useRef(null);return nt.useEffect((()=>{if(!e.current)throw new Error;return((t,e)=>{new Bt({root:t,defaultValue:e,listener:{markdown:[t=>console.log(t())]}}).use(Ft).use(Wt).use(Jt).use(Ae).use(Je).use(Ce).use(As).create()})(e.current,t),()=>{var t;null==(t=e.current)||t.remove()}}),[t]),nt.createElement("div",{className:"milkdown-demo",ref:e})};const Ls=()=>{const[t,e]=nt.useState(!1);return nt.useEffect((()=>{document.documentElement.setAttribute("data-theme",t?"dark":"light");let e=document.querySelector("#prism-theme");if(!e){const t=document.createElement("link");t.id="prism-theme",t.setAttribute("rel","stylesheet"),document.head.appendChild(t),e=t}e.setAttribute("href",t?"https://cdn.jsdelivr.net/npm/prism-themes@1.7.0/themes/prism-nord.css":"https://cdn.jsdelivr.net/npm/prism-themes@1.7.0/themes/prism-material-light.css")}),[t]),nt.createElement("header",{className:"doc-header"},nt.createElement("div",{className:"doc-header_left"},nt.createElement("span",{className:"icon material-icons-outlined"},"menu"),nt.createElement("a",{href:"/milkdown/",className:"doc-header_icon"},nt.createElement("img",{className:"logo",src:"/milkdown/milkdown-mini.svg"}),nt.createElement("span",{className:"title"},"Milkdown"))),nt.createElement("div",{className:"doc-header_right"},nt.createElement("span",{onClick:()=>e(!t),className:"icon material-icons-outlined"},t?"light_mode":"dark_mode"),nt.createElement("a",{href:"https://github.com/Saul-Mirone/milkdown",className:"doc-header_github"},nt.createElement("span",{className:"icon material-icons-outlined"},"open_in_new"),nt.createElement("span",null,"Open in Github"))))},Cs=()=>nt.createElement(nt.Fragment,null,nt.createElement(Ls,null),nt.createElement(Es,{content:"# Milkdown\n\n![logo](https://preview.redd.it/us7w1x2zx8461.jpg?auto=webp&s=077a73d5c08aec0bc0fb48c5e5be40c928467bb6)\n\n> Milkdown is a WYSIWYG markdown editor.\n>\n> Here is the [repo](https://github.com/Saul-Mirone/milkdown) (_right click to open link_).\n\nYou can check the output markdown text in **developer tool**.\n\n---\n\nYou can add `inline code` and code block:\n\n```javascript\nfunction main() {\n    console.log('Hello milkdown!');\n}\n```\n\n---\n\nYou can type `||` and a `space` to create a table:\n\n| First Header   |   Second Header    |\n| -------------- | :----------------: |\n| Content Cell 1 |  `Content` Cell 1  |\n| Content Cell 2 | **Content** Cell 2 |\n\n---\n\nMath is supported by [TeX expression](https://en.wikipedia.org/wiki/TeX).\n\nNow we have some inline math: $V \\times W \\stackrel{\\otimes}{\\rightarrow} V \\otimes W$. You can click to edit it.\n\nMath block is also supported.\n\n$$\n\\begin{aligned}\nT( (v_1 + v_2) \\otimes w) &= T(v_1 \\otimes w) + T(v_2 \\otimes w) \\\\\nT( v \\otimes (w_1 + w_2)) &= T(v \\otimes w_1) + T(v \\otimes w_2) \\\\\nT( (\\alpha v) \\otimes w ) &= T( \\alpha ( v \\otimes w) ) \\\\\nT( v \\otimes (\\alpha w) ) &= T( \\alpha ( v \\otimes w) ) \\\\\n\\end{aligned}\n$$\n\nYou can type `$$` and a `space` to create a math block.\n\n---\n\nHave fun!\n"}));const _s=document.getElementById("app");if(!_s)throw new Error;it.render(nt.createElement(Cs,null),_s);
